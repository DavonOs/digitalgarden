---
{"dg-publish":true,"dg-permalink":"books/35799208/02","permalink":"/books/35799208/02/","metatags":{"description":"xlwings 创始人教你如何让 Excel 飞起来！* 告别烦琐公式和 VBA 代码* 办公人士零压力学 Python* 流行 Python 库 xlwings 创始人亲授每当花上几小时手动更新 Excel 工作簿时，或者每当 Excel 工作簿因保存了太多数据而崩溃时，你都应该停下来，思考自己是否应该换个工作方式。本书将展示为什么在 Excel 中引入 Python 是明智之举——你将能够轻松突破 Excel 的瓶颈，避免人为错误，把更多宝贵的时间花在能产生更大价值的任务上。在微软运营的在线用户反馈论坛上，大量用户提出希望“将 Python 作为 Excel 的脚本语言”。相比 Excel 现有的 VBA 语言，Python 究竟有何优势，又该如何发挥这些优势？开源 Python 库 xlwings 的诞生很好地回答了这些问题，它让 Excel 和 Python 珠联璧合。作为 xlwings 的创始人，本书作者将展示如何借用 Python 的力量，让 Excel 快得飞起来！xlwings 帮助 Excel 用户利用 Python 脚本将任务自动化，从而实现效率飞跃。费利克斯在工作中接触了大量 Excel 用户，这使他对 Excel 在各行各业中的使用瓶颈和解决思路拥有深刻的见解。","og:site_name":"DavonOs","og:title":"Excel Python","og:type":"book","og:url":"https://zuji.eu.org/books/35799208/02","og:image":"https://file.ituring.com.cn/LargeCover/22038dc37469788a2ed5","og:image:width":"50","og:image:alt":"bookcover"},"created":"2025-09-24 13:26","updated":"2025-09-26 15:58"}
---

## 2.1 AnacondaPython 发行版
Anaconda 可以说是用于数据科学的最受欢迎的 Python 发行版。它预装了数百个第三方包，其中包括 Jupyter 笔记本以及大部分本书要大量使用的包（pandas、OpenPyXL 和 xlwings）。Anaconda 个人版可免费用于私人用途，并且保证所有内置的包相互兼容。这些包全部都安装在一个文件夹中，卸载起来很轻松。在安装完 Anaconda 之后，我们会先学习一下 Anaconda Prompt 的基础命令并启动一个交互式 Python 会话，然后会介绍 Conda 包管理器和 pip，最后以 Conda 环境作为本节的结尾。现在先来下载和安装 Anaconda。

### 2.1.1 安装

前往 Anaconda 主页下载最新版的 Anaconda 安装器（个人版，Individual Edition）。要确保下载的是 Python 3. x 版本的 64 位图形化安装器。下载完成之后，双击安装器开始安装，确保所有选项保持默认值。更详细的安装过程请参照 Anaconda 官方文档。

其他 Python 发行版

其他 Python 发行版本书假定你安装了个人版的 Anaconda，但是书中展示的代码和概念对于任何 Python 版本都是通用的。不过对于其他发行版，你需要参照配套代码库中的 requirements. txt 文件安装所需依赖项。

安装好 Anaconda 之后，就可以启动 Anaconda Prompt 开始学习了。下面来看看这是个什么东西，又是如何工作的。

### 2.1.2 Anaconda Prompt

Anaconda Prompt 实际上就是 Windows 中的一个命令提示符或者 macOS 中的终端，只不过它配置好了 Python 解释器和第三方包。Anaconda Prompt 是执行 Python 代码的最基本的工具，本书会大量使用它来执行 Python 脚本和各种包提供的命令行工具。

如果没有 Anaconda

如果没有选用 Anaconda Python 发行版，那么在需要使用 Anaconda Prompt 的时候就要在 Windows 中使用命令提示符，或者在 macOS 中使用终端。

不用担心从来没有用过 Windows 中的命令提示符或者 macOS 中的终端。你只需要知道一小部分命令就够用了。一旦习惯了，Anaconda Prompt 就比你在图形用户菜单上点来点去快得多，也方便得多。现在开始吧。

Windows

点击开始菜单，输入 Anaconda Prompt。在显示的项目中选择 Anaconda Prompt，而不是 Anaconda Powershell Prompt。可以用方向键选择，然后按回车键，也可以用鼠标单击。如果你更喜欢在开始菜单中打开，可以在 Anaconda 3 文件夹中找到它。本书会一直使用 Anaconda Prompt，因此你可以把它固定在 Windows 任务栏上。Anaconda Prompt 的输入行会以（base）开头。

（base）C:\Users\felix>

macOS

在 macOS 中，你不会看到名为 Anaconda Prompt 的应用程序。我提到 Anaconda Prompt 的时候，实际上指的是被 Anaconda 安装器配置好并激活了 Conda 环境的终端（稍后我会更详细地介绍 Conda 环境）：按下快捷键 Command- 空格，或者打开启动台，输入 Terminal 然后按回车键。也可以打开访达，找到“应用程序 > 实用工具”，在这里可以找到终端然后双击启动。终端窗口出现后，应该可以看到下面这样的内容，输入行也是以（base）开头的：

（base） felix@MacBook- Pro ~ %

如果你用的是较旧版本的 macOS，那么看起来应该是这样：

（base）MacBook- Pro:~ felix$

和 Windows 中的命令提示符不一样，macOS 中的终端并不会显示当前目录的完整路径。波浪符号代表的是 home 目录，一般来说就是  $/\mathrm{Users} / <$  用户名  $>$  。要查看你当前所在目录的完整路径，需要输入 pwd 然后按回车键。pwd 的意思是打印工作目录。

如果在安装完 Anaconda 之后，终端的输入行并没有以（base）开头，一般来说是如下原因：如果在安装 Anaconda 的过程中终端正在运行，就需要重新启动终端。注意，点击终端窗口左上角的红叉只会隐藏窗口，而不是退出终端。你需要在 dock 栏的终端图标上右键单击，然后选择退出；或者在终端窗口激活的情况下按快捷键 Command- Q 退出。当再次启动终端时，输入行会在开头显示（base)，至此就准备就绪了。本书会一直使用终端，你可以把它固定到 dock 栏上。

Anaconda 启动后，尝试一下表 2- 1 中列出的命令。随后我会详细解释每一个命令。

表 2-1：AnacondaPrompt 的命令  

| 命令         | Windows           | macOS           |
| ---------- | ----------------- | --------------- |
| 列出当前目录中的文件 | dir               | ls -la          |
| 切换目录（相对路径） | cd path\to\dir    | cd path/to/dir  |
| 切换目录（绝对路径） | cd C:\path\to\dir | cd /path/to/dir |
| 切换至驱动器 D   | D:                | （无）             |
| 切换至父目录     | cd ..             | cd ..           |
| 回到前一个命令    | （上箭头）             | （上箭头）           |


列出当前目录中的文件

在 Windows 中，输入 dir 并按回车键。命令提示符会打印出当前所在目录的内容。

在 macOS 中，输入 ls- la 并按回车键。ls 的意思是列出目录内容，而- la 会将输出内容以长列表格式显示，且包含所有文件，也就是说隐藏文件也会显示出来。

切换目录

输入 cdDown 并按 tab 键。cd 代表切换目录。如果位于 home 文件夹中，那么 AnacondaPrompt 极有可能会将刚才输入的内容自动补全为 cdDownloads。如果位于其他的文件夹中，或者并没有一个叫作 Downloads 的文件夹，那么选择一个你在之前的命令（dir 或者 ls- la）输出内容中看到的目录，然后打出它的目录名的开头，再按下 tab 键自动补全。如果你在 Windows 中操作并且需要切换驱动器，则在切换到正确的目录之前需要先输入驱动器名称：

C:\Users\felix>D: D:\>cd data D:\data>

注意，如果路径以你当前所在目录中的文件夹名或文件名开始，那么你用的就是相对

路径，比如 cd Downloads。如果想离开当前目录，可以输入绝对路径，比如在 Windows 中输入 cd C:\Users，在 macOS 中输入 cd /Users（注意开头的斜杠）。

切换至父目录

切换至父目录要切换至父目录（上一级目录），需要输入 cd .. 然后按回车键（确保在 cd 和两点之间有一个空格）。可以将这个命令和目录名相结合，如果你想先返回上一级目录，然后进入 Desktop，可以输入 cd ..\Desktop。在 macOS 中，要把反斜杠换成斜杠。

回到前一个命令

回到前一个命令用上箭头键回到前一个命令。如果需要反复执行同样的命令，则这样做可以让你少敲很多次键盘。如果滚动过头了，按下箭头键向后滚动。

文件扩展名

不幸的是，Windows 和 macOS 默认都隐藏了文件资源管理器文件和访达中的扩展名。在使用 Python 脚本和 Anaconda Prompt 的时候，这种设置并不友好，因为它们需要你在引用文件时带上扩展名。使用 Excel 的时候，显示文件扩展名也能帮你弄清楚是在处理默认的 xlsx 文件，还是启用了宏的 xlsx 文件，抑或其他 Excel 文件格式。可以像下面这样让文件扩展名显示出来。

Windows

打开文件资源管理器，点击查看标签。在显示／隐藏分组下，勾选“文件扩展名”。macOS

打开访达，然后按下快捷键 Command，（Command 和逗号）。在高级标签中，勾选“显示所有文件扩展名”。

就是这样！现在你能够启动 Anaconda Prompt 并在期望的目录中执行命令了。在下一节中，我会教你如何启动交互式 Python 会话，届时你会用到刚才所学的技能。

# 2.1.3 Python REPL：交互式 Python 会话

在 AnacondaPrompt 中，可以通过执行 python 命令启动一个交互式 Python 会话：

```
（base）C:\Users\felix>python
Python 3.8.5（default，Sep 3 2020，21:29:08）[...] :: Anaconda，Inc. on win 32 Type "help"，"copyright"，"credits" or "license" for more information.>>>
```

macOS 终端中显示的文本可能有些不一样，但是道理都是一样的。本书是按照 Python 3.8 版本撰写的，如果你想用更新的版本，一定要看一下本书主页上的说明。

AnacondaPrompt 的表示方法

接下来，本书会用（base）>开头的代码行来表示这是在 AnacondaPrompt 中输入的。比如，要启动一个交互式 Python 会话，会这么写：

(base)>python

在 Windows 中是下面这样：

(base) C:\Users\felix>python

在 macOS 中则是这样（记住，终端就是你的 AnacondaPrompt）。

(base) felix@MacBook- Pro \~ % python

先来试一下。注意，交互式会话中的 >>> 代表 Python 正在等待你的输入——不需要把这 3 个符号也输入进去。输入下面以 >>> 开头的代码，然后按回车键确认：
```
>>>3+4
7
>>>"python" *3 
python python python
```

交互式 Python 会话也被称为 REPL，意思是读取－求值－输出循环（read- eval- printloop）。Python 会读取你的输入，对其求值，然后立即输出结果并等待下一次输入。还记得第 1 章提到的《Python 之禅》吗？现在你可以读到它的完整版，从而深入理解 Python 的指导原则。输入下面这行内容，然后按回车键：

```
>>> import this
```

要退出 Python 会话，需要输入 quit () 并按回车键。也可以在 Windows 中按下快捷键 Ctrl + Z，然后按回车键。在 macOS 中需按下快捷键 Ctrl- D（不需要按回车键)。

退出 PythonREPL 之后，接下来该尝试一下 Anaconda 为我们安装的 Conda 和 pip 包管理器了。

# 2.1.4 包管理器：Conda 和 pip

我在前面提到过 Python 的包管理器 pip，它负责下载、安装、更新和卸载 Python 包及其依赖项和子依赖项。虽然 Anaconda 也可以配合 pip 工作，但是它还有一个名为 Conda 的内置包管理器。Conda 的一大优势是不仅可以安装 Python 包，还可以安装多种版本的 Python 解释器。一言以蔽之：软件包可以为 Python 添加标准库中所没有的功能。第 5 章将介绍的 pandas 就是这样的包。由于 AnacondaPython 发行版已经预装好了这些包管理器，因此就不需要我们手动安装了。

> Conda 和 pip
> 在使用 Anaconda 的情况下，应该尽可能地用 Conda 安装各种软件包。而 pip 只是用来安装那些在 Conda 中找不到的软件包。不然的话 Conda 可能会覆盖你用 pip 安装的包。

表 2-2 列出了最常用的命令。这些命令必须在 Anaconda Prompt 中输入，可以让你安装、更新和卸载第三方包。

表 2-2：Conda 命令和 pip 命令

| 操作         | Conda                       | pip                           |
| ---------- | --------------------------- | ----------------------------- |
| 列出所有已安装的包  | conda list                  | pip freeze                    |
| 安装指定包的最新版本 | conda install package       | pip install package           |
| 安装指定包版本    | conda install package=1.0.0 | pip install package=1.0.0     |
| 更新包        | conda update package        | pip install --upgrade package |
| 卸载包        | conda remove package        | pip uninstall package         |


如果想查看你安装的 Anaconda 发行版中已经安装了哪些包，可以输入以下代码：

(base)>conda list

每当需要用到 Anaconda 没有预装的一个包时，本书都会明确指出并且告诉你该怎么安装。不过也可以现在安装这些包，这样之后就必须为此担心了。先来安装 Plotly 和 xlutils，这两个包都可以在 Conda 中找到：

(base)>conda install plotly xlutils

在执行这条命令之后，Conda 会向你表明它要干些什么，你需要输入 y 并按回车键表示确认。完成之后，还可以通过 pip 来安装 pyxlsb 和 pytrends，这两个包 Conda 中没有：

(base)>pip install pyxlsb pytrends

和 Conda 不一样，pip 在你按回车键之后会立即开始安装而不需要确认。

包的版本

很多 Python 包会频繁更新，有时候会引入一些无法向后兼容的更改。这可能会导致书中的一些例子无法正常工作。我会试着跟进这些改动，并且会把修复方法发在本书主页上。不过你也可以创建一个 Conda 环境，使用和书中相同的版本。下一节会介绍 Conda 环境，你也可以在附录 A 中找到有关创建一个带有特定包的 Conda 环境的详细说明。

现在你已经知道了如何用 Anaconda Prompt 启动一个 Python 解释器并安装额外的包。在下一节中，我会解释 Anaconda Prompt 每行开头的（base）是什么意思。

# 2.1.5 Conda 环境

你可能很好奇 AnacondaPrompt 每行开头的（base）到底是什么。它是当前激活的 Conda 环境的名称。Conda 环境是一个被隔离的“Python 世界”，有着特定版本的 Python 和一系列安装好的包。为什么非要这么做呢？当你同时开发多个项目的时候，各个项目会有不同的需求：一个项目可能需要 Python 3.8 和 pandas 0.25.0，而另一个项目可能需要 Python 3.9 和 pandas 1.0.0。由于为 pandas 0.25.0 编写的代码往往需要进行修改才能用到 pandas 1.0.0 上，因此不能只更新 Python 和 pandas 而保持代码原封不动。为每个项目都配置一个 Conda 环境可以保证它们使用正确的依赖项运行。Conda 环境虽然是 Anaconda 发行版的专有概念，但虚拟环境是所有 Python 发行版的通用概念。相比之下 Conda 环境更加强大，因为它不仅可以管理多个版本的软件包，还可以轻松管理不同版本的 Python 解释器。

在学习本书的过程中，你不用切换 Conda 环境，我们会一直使用默认的 base 环境。不过当你创建新项目时，为每个项目使用单独的 Conda 环境或者虚拟环境是很好的实践方式。这可以让你规避不同项目之间的依赖冲突。关于 Conda 环境的必备知识都可以在附录 A 中找到，你还可以从中了解如何创建带有指定版本的包的 Conda 环境——在我撰写本书时也使用了同样的方法。这样即便时隔多年，书中的示例代码依然可以照常运转。你也可以到本书主页上查看使用新版 Python 和相关包所需做出的改动。

解开了关于 Conda 环境的未解之谜，是时候介绍我们马上就会用到的另一个工具了：Jupyter 笔记本。

# 2.2 Jupyter 笔记本

上一节展示了如何从 AnacondaPrompt 中启动交互式 Python 会话。如果你想在干净的环境中测试一些简单的东西，那么这自然很好用。然而在大部分时候，你会想要一个更好用的环境，比如，回到之前的命令，显示 AnacondaPrompt 中 Python REPL 难以显示的图表。幸运的是，Anaconda 不止有 Python 解释器，还包含了 Jupyter 笔记本（Jupyter notebook）。在数据科学领域，人们热衷于使用 Jupyter 笔记本来运行代码。有了它，你可以把格式规整的可执行 Python 代码、图片和图表融合到一个交互式笔记本中，并且这个笔记本是运行在浏览器中的。Jupyter 笔记本对初学者很友好，特别是当你刚开始学 Python 的时候。另外，它们在教学、原型开发、研究等领域也极为受欢迎，因为极大地方便了可重现的研究。

Jupyter 笔记本可以快速准备、分析和可视化数据，这和工作簿的用例几乎相同。它已然成了 Excel 的竞争者。但和 Excel 不同，Jupyter 笔记本是用 Python 代码来完成这些工作的，而不是用鼠标在 Excel 中点来点去。Jupyter 笔记本的另一个优势是，它不会把数据和业务逻辑混在一起。Jupyter 笔记本会负责你的代码和图表，而你通常都是使用来自外部 CSV 文件或者数据库中的数据。Python 代码的可视化能够让你轻松把握正在发生的事情，不像 Excel 中的公式会被单元格的值藏起来。Jupyter 笔记本在本地和远程服务器上都可以运行，一般来说，服务器要比本地机器性能更强，它可以在无人值守的情况下运行代码，Excel 则很难做到。

本节会向你展示如何运行和操作 Jupyter 笔记本。我们会了解到笔记本单元格的相关知识，以及编辑模式和命令模式之间的区别。之后你便会明白为什么文本单元格的执行顺序非常重要。最后我们会学习如何正确地关闭笔记本。下面来创建我们的第一个笔记本吧。

### 2.2.1 运行 Jupyter 笔记本

在 Anaconda Prompt 中，切换至配套代码库所在目录，然后启动 Jupyter 笔记本服务器：

```
(base)> cd C:\Users\username\python-for-excel
(base)> jupyter notebook
```

浏览器会自动启动，打开的 Jupyter 仪表板会显示执行命令时所在目录中的文件。在 Jupyter 仪表板的右上方，点击新建，在下拉列表中选择 Python 3，如图 2- 2 所示。

![](https://cdn-mineru.openxlab.org.cn/result/2025-09-15/dd9a4891-4e25-48b7-8140-6cdacb8609b4/9e96d6f4bc88b4719a3b4a689992870f96aa201e8383db992d4f086aa9538e42.jpg)  
图 2-2：Jupyter 仪表板

浏览器会为你的第一个空白笔记本打开新的标签页，如图 2- 3 所示。

![](https://cdn-mineru.openxlab.org.cn/result/2025-09-15/dd9a4891-4e25-48b7-8140-6cdacb8609b4/8305b4c2c347b987b4308b1eef6a6ac6c1986bb47feaf1b9a5014e8a756b0cc7.jpg)  
图 2-3：空白的 Jupyter 笔记本

要养成重命名的好习惯。点击 Jupyter logo 旁边的 Untitled 1，为工作簿取一个更有意义的名字，比如 first_notebook。图 2-3 的下半部分展示了笔记本的单元格——下一节会详细介绍。

### 2.2.2 笔记本单元格

在图 2- 3 中，你会看到一个光标在空白单元格中闪烁。如果光标没有闪烁，用鼠标点一下这个单元格，也就是 `In[ ]` 右边这块。现在来重做上一节的练习：输入，然后点击上面菜单栏中的运行按钮，或者用更方便的快捷键：Shift+ 回车。单元格中的代码将会执行，并把结果输出到单元格下方，然后跳到下一个单元格。由于目前我们只有一个单元格，因此笔记本会在下面插入一个空白单元格。现在再仔细看一下，当单元格正在计算时，会显示 `In [*]`；在计算完成时，星号就变成了数字，也就是 `In [1]`。在这个单元格下方你会看到对应的输出单元格，而且和输入单元格有相同的编号：`Out [1]`。每当你运行一个单元格，编号就会加 1，这个编号可以帮助你识别单元格执行的顺序。从现在起，本书会用如下格式展示示例代码，比如，之前讲解 REPL 时的示例代码会像这样展示：

```
In [1]: 3 + 4 
Out[1]: 7
```

这种记法可以让你快速理解应该在笔记本单元格中输入 3 + 4 。按下快捷键 Shift+ 回车执行单元格之后，你会在 `Out[1]` 中得到相同的结果。如果你阅读的是支持颜色显示的电子书，则会注意到有着不同颜色输入单元格的格式字符串、数字等内容会更加容易阅读。这就叫语法高亮（syntax highlighting）。

> 单元格的输出
> 如果单元格的最后一行返回了一个值，那么它会自动输出到 Jupyter 笔记本的 `Out[]` 单元格中。然而，如果你使用的是 print 函数或者发生了异常，则相应的输出会直接显示在 In 单元格下方而没有 `Out[]` 标签。本书示例代码的格式会反映出这种行为。

单元格有不同的类型，我们需要关注以下两种。

代码

默认类型。需要执行 Python 代码时就会用到它。

Markdown

Markdown 是一种格式化语法，它使用标准的文本字符来格式化文本。可以用它在笔记本中添加格式规整的解释和说明。

要把单元格的类型切换为 Markdown，先选中单元格，然后在单元格模式下拉菜单中选择 Markdown（参见图 2-3）。表 2-3 展示了切换单元格模式的快捷键。

表 2-3：键盘快捷键（命令模式）  

| 快捷键       | 操作                   |
| --------- | -------------------- |
| Shift+ 回车 | 执行单元格（编辑模式中同样可用）     |
| ↑（上箭头）    | 将单元格选择器上移            |
| ↓（下箭头）    | 将单元格选择器下移            |
| b         | 在当前单元格下方插入新单元格       |
| a         | 在当前单元格上方插入新单元格       |
| dd        | 删除当前单元格（按两次字母 d）     |
| m         | 将单元格类型模式切换至 Markdown |
| y         | 将单元格类型切换至代码          |


按下快捷键 Shift+ 回车之后，这段文本会被渲染成格式规整的 HTML。此时你的笔记本应该类似于图 2- 4 这样。Markdown 单元格还可以添加图片、视频或公式。参见 Jupyter 笔记本的文档。

![](https://cdn-mineru.openxlab.org.cn/result/2025-09-15/dd9a4891-4e25-48b7-8140-6cdacb8609b4/851a1087a3e0d5e13a07dce43ca3684dcd06ca862c552e76c255f62a8993f060.jpg)  
图 2-4：运行代码单元格和 Markdown 单元格后的笔记本

现在你已经了解了代码单元格和 Markdown 单元格，是时候学习如何在各个单元格之间快速切换了。下一节会介绍什么是编辑模式和命令模式，以及一些键盘快捷键。

### 2.2.3 编辑模式与命令模式

当和 Jupyter 笔记本中的单元格互动时，你要么处于编辑模式（editing mode），要么处于命令模式（command mode）。

编辑模式

点击一个单元格以启动编辑模式。被选中的单元格边缘会变成绿色，单元格中的光标也会开始闪烁。除了点击单元格，还可以在选中单元格时按回车键。

命令模式

要切换至命令模式，需要按下 Esc 键。被选中的单元格边缘会变成蓝色且不会出现光标。表 2- 3 是在命令模式下可用的最重要的快捷键。

了解这些快捷键可以让你更高效地使用笔记本，而不用一直在键盘和鼠标之间来回切换。在下一节中，我会告诉你一些使用 Jupyter 笔记本时经常遇到的陷阱：单元格的执行顺序很重要。

### 2.2.4 执行顺序很重要

Jupyter 笔记本易于上手，但如果不按顺序运行单元格，也容易让人摸不着头脑。假设你的笔记本中有下面这样几个单元格，从上往下执行：

In[2]:a=1 In[3]: a Out[3]: 1 In[4]:a=2

单元格 Out[3]会按照预期输出 1。然而，如果你回去再一次执行 In[3]，就会得到下面的结果：

In[2]:a=1 In[5]: a Out[5]: 2 In[4]:a=2

Out[5]表明现在 a 的值为 2。当从上往下阅读笔记本时，这可能不是你所期望的结果特别是当 In[4]离得很远，还需要把页面滚动过去的时候。为了避免这种情况，建议你不要只返回一个单元格，而是返回前面所有的单元格。Jupyter 笔记本在上面的“单元格  $>$  运行”菜单中提供了一种简单的方法来完成这样的操作。在讲完这些注意事项之后，来看看应该如何正确地关闭笔记本。

### 2.2.5 关闭 Jupyter 笔记本

每个笔记本都在一个独立的 Jupyter 内核中运行。内核是运行单元格中 Python 代码的“引

擎”。每个内核都会消耗操作系统提供的 CPU 和 RAM 资源。因此在关闭笔记本时，还需要关闭它的内核，以便内核所占用的资源可以被其他任务重用——从而防止系统变慢。最简单的方法是选择菜单中的“文件  $\gimel$  关闭”。如果只是关闭了浏览器标签页，那么内核并不会自动关闭。另外，在 Jupyter 仪表板中，也可以从运行标签页中关闭正在运行的笔记本。

要关闭整个 Jupyter 服务器，可以点击 Jupyter 仪表板右上方的退出按钮。如果已经关闭了浏览器，可以在运行笔记本服务器的 AnacondaPrompt 中按两次快捷键  $\mathrm{Ctrl} + \mathrm{C}$  ，或者连同 AnacondaPrompt 一起关闭。

云上的 Jupyter 笔记本

Jupyter 笔记本广受欢迎，许多云服务供应商已经将其作为一种受托管的解决方案来提供。接下来介绍的这 3 种服务都是免费的。这些服务的优势在于，只要有一个浏览器，你就可以从任何地方快速访问这些服务，而无须在本地安装任何东西。例如，你可以在阅读本书前 3 部分的时候，在平板计算机上运行其中的示例代码。不过由于第四部分需要在本地安装 Excel，因此这一部分不能用这种方法。

Binder

Binder 是由 ProjectJupyter 提供的服务，后者是 Jupyter 笔记本背后的组织。Binder 可以直接运行公共 Git 仓库中的 Jupyter 笔记本。由于不需要在 Binder 中存储任何内容，因此也不需要注册或者登录。

KaggleNotebook

Kaggle 是一个数据科学平台。Kaggle 会组织数据科学竞赛，你可以轻松访问大量的数据集。自 2017 年起，Kaggle 成了谷歌旗下产品。

GoogleColab

GoogleColab（Colaboratory 的简称）是谷歌的笔记本平台。不幸的是，Jupyter 笔记本中的大部分快捷键无法用到 Colab 中，不过你可以在 Colab 中直接访问 GoogleDrive 上的文件（包括 GoogleSheets）。

访问配套代码库中的 Jupyter 笔记本的最简单的方法是访问它的 BinderURL。由于你操作的是配套代码库的一个副本，因此可以随心所欲地编辑和“搞破坏”。

你已经知道了如何使用 Jupyter 笔记本，下面接着来学习如何编写和运行标准的 Python 脚本。我们需要用到 VSCode，这是一个完美支持 Python 的超强文本编辑器。

# 2.3 VS Code

本节会安装并配置 VSCode，它是微软开发的一个免费且开源的文本编辑器。在介绍它最重要的组件之前，我们会先写一个 Python 脚本并用几种方式来运行它。不过在一开始，我会先解释在什么时候不应该用 Jupyter 笔记本运行 Python 脚本，以及为什么选择在本书中使用 VSCode。

Jupyter 笔记本虽然对于研究、教学和实验这类互动型的工作流程来说很好用，但是如果想编写针对生产环境的 Python 脚本（这类脚本用不到笔记本的可视化功能），Jupyter 笔记本并非理想之选。再者，对于一些涉及大量文件和多位开发者的复杂项目，Jupyter 笔记本也不是那么好用。在这种情况下，你会想要使用一个更合适的文本编辑器来编写和运行传统的 Python 文件。理论上来讲，可以使用任何文本编辑器（哪怕是记事本也行)，但实际上你需要的是一个可以“理解”Python 的编辑器。这样的编辑器至少应该有如下特性。

语法高亮

编辑器会为具有不同语义（函数、字符串、数字，等等）的单词赋予不同的颜色，从而使得代码更容易阅读和理解。

自动补全

自动补全（autocomplete），或者用微软的话来讲叫智能感知（intelliSense），可以为文本组件提供建议，以便你少打字、少打错字。

很快，你还会有其他需求。你会想要直接从编辑器中访问下面这些功能。

执行代码

如果为了运行代码需要在文本编辑器和外部 AnacondaPrompt（比如命令提示符或终端）之间来回切换，则这会让人觉得很麻烦。

调试器

调试器可以让你一行行地执行代码，观察它们的运行情况。

版本控制

如果你用到了 Git 来管理文件，那么想要在编辑器中进行相关的操作是很自然的需求。这样就不用在各种应用程序之间来回切换了。

有一大堆工具可以满足上述需求，具体的选择也取决于开发者自身需求和偏好。一些开发者可能确实只想要一个朴素的文本编辑器和外部命令提示符。而有些开发者可能更喜欢集成开发环境（integrated development environment，IDE）：IDE 试图将所有你可能会用到的东西集成到一个工具中，有时候它们会显得很臃肿。

VS Code 自 2015 年发布以来就深受开发者喜爱。我也选择了它。在 2019 年的 Stack Overflow

开发者调查中，它成了最受欢迎的开发环境。为什么 VS Code 如此受欢迎呢？简单来说，它恰如其分地融合了纯文本编辑器和全功能 IDE：VS Code 是一个迷你 IDE，囊括了编程所需要的所有工具。除此之外，它还具有如下特性。

跨平台

VS Code 可以在 Windows、macOS 和 Linux 中运行，也有像 GitHub Codepaces 这样的云托管版本。

集成工具

VS Code 内置调试器，支持 Git 版本控制，还有可以用作 Anaconda Prompt 的集成终端。

扩展

包括 Python 支持在内的其他所有功能，都可以以扩展的形式一键安装。

轻量

根据操作系统的不同，VS Code 的安装包仅有 50 MB~100 MB 大小。

> VS Code 和 Visual Studio
> 不要把 VS Code 和名为 Visual Studio 的 IDE 搞混了！虽然也可以用 Visual Studio 来进行 Python 开发 Visual Studio 有 PTVS（Python Tools for Visual Studio，适用于 Visual Studio 的 Python 工具），但是需要安装很多东西。传统上 Visual Studio 是用来做.NET 语言（如 C#）开发的。

# 2.3.1 安装和配置

在 VS Code 主页上下载安装器。请参照官方文档获取最新的安装说明。

Windows

双击安装器并接受所有默认设置。然后从开始菜单启动 VS Code，你可以在 Visual Studio Code 文件夹下找到它。

macOS

双击 ZIP 文件解压。将 Visual Studio Code. app 拖放到应用程序文件夹，这样你就可以从启动台启动它了。如果 VS Code 没有启动，就在“系统偏好设置  $>$  安全性和隐私  $>$  通用”中选择仍要打开。

第一次打开 VS Code 的时候，它看起来应该是图 2- 5 所示的样子。注意，我把默认的黑暗主题切换成明亮主题了，这样截图才更容易看清楚。

![](https://cdn-mineru.openxlab.org.cn/result/2025-09-15/dd9a4891-4e25-48b7-8140-6cdacb8609b4/73aac0d17e717c20e2ab727bfd7ea3e4cafe724e09bf57f654292f17dcbf5a6d.jpg)  
图 2-5：VS Code

活动栏

活动栏位于左侧，它上面的图标从上往下依次为以下几项。

- 资源管理器
- 搜索
- 源代码管理
- 运行
- 扩展

状态栏

编辑器底部是状态栏。一旦配置完成，开始编辑一个 Python 文件，你就会在这里看到所选的 Python 解释器。

命令面板

按下 F 1 键或者快捷键：Ctrl+Shift+P（Windows 系统）或者 Command- Shift- P（macOS 系统），可以打开命令面板。如果对某些东西拿不准，你首先就应该想到命令面板。VS Code 所有功能的快捷入口都在其中。如果想找键盘快捷键，可以输入 keyboard shortcuts，选择“帮助：键盘快捷方式参考”，然后按回车键。

VS Code 确实是一个开箱即用的优秀文本编辑器，但是要让它完美配合 Python，还需要进行一些配置。点击活动栏上的扩展图标，然后搜索 Python。安装作者显示为微软（Microsoft）的官方 Python 插件。待其安装完成之后，可以点击需要重新加载按钮来完成安装。或者也可以完全重启 VS Code。最后根据操作系统完成相应的配置。

Windows

打开命令面板，输入 default profile。选择“终端：选择默认配置文件”这一项，然后按回车键。在下拉菜单中，选择命令提示符并按回车键确认。我们需要这样设置，以便 VS Code 正常激活 Conda 环境。

macOS

打开命令面板，输入 shell command。选择“Shell 命令：在 PATH 中安装‘code’命令”这一项，然后按回车键。这样设置之后才可以从 Anaconda Prompt（如终端）中方便地启动 VS Code。

现在 VS Code 已经安装并配置完毕，下面开始编写并运行我们的第一个 Python 脚本吧。

# 2.3.2 执行 Python 脚本

虽然可以从 Windows 的开始菜单或者 macOS 的启动台打开 VS Code，但是直接从 Anaconda Prompt 中打开会更快——可以直接用 code 命令启动 VS Code。接下来，打开一个新的 Anaconda Prompt，通过 cd 命令将目录切换到你希望进行操作的地方，然后让 VS Code 打开当前目录（用点表示）：

(base)> cd C:\Users\username\python- for- excel (base)> code.

以这种方式启动 VS Code 可以让活动栏中的资源浏览器自动显示启动目录中的内容。

另外，也可以通过“文件  $\gimel$  打开文件夹（在 macOS 中是“文件  $\gimel$  打开"）菜单项打开文件夹，不过在第四部分涉及 xlwings 的时候，macOS 可能会报出权限问题。当你把鼠标悬停在活动栏的资源管理器中的文件上时，会看到图 2- 6 所示的新建文件按钮。点击新建文件，取名为 hello_world. py，然后按回车键。当文件在编辑器中打开之后，输入下面这行代码：

print ("hello world!")

还记得在 Jupyter 笔记本中，最后一行代码的返回值会自动输出吗？但是对于一般的 Python 脚本来说，你需要明确告诉 Python 输出什么，因此这里就需要用到 print 函数。在状态栏中，应该可以看到 Python 的版本，比如“Python 3.8.5 64- bit (conda)”。如果点一下它，命令面板会显示让你选择一个不同的 Python 解释器（如果你有好几个的话），也包括不同的 Conda 环境。现在你的配置如图 2- 6 所示。

![](https://cdn-mineru.openxlab.org.cn/result/2025-09-15/dd9a4891-4e25-48b7-8140-6cdacb8609b4/0ab461acfce971f75ebdfba2a1bb84de18037896cd5425c0f3b02d2d4d91b33d.jpg)  
图 2-6：打开了 hello_world. py 的 VS Code

在执行脚本之前，一定要先保存。在 Windows 中可以按快捷键  $\mathrm{Ctrl + S}$  进行保存，在 macOS 中则是按快捷键 Command- S。在 Jupyter 笔记本中，只需选择一个单元格然后按快捷键 Shift+回车就可以运行这个单元格了。在 VS Code 中，可以通过 Anaconda Prompt 运行，也可以直接点运行按钮。当你要执行一个服务器上的脚本时，可能更多地还是从 Anaconda Prompt 中执行，所以有必要知道具体如何操作。

Anaconda Prompt

打开 Anaconda Prompt，将 cd 放入脚本所在的文件夹中，按如下方式运行脚本：

(base)>cd C:\Users\username\python- for- excel (base)>python hello_world. py hello world!

最后一行是脚本会打印出来的输出。注意，如果你当前不在 Python 文件所在的目录，则需要使用完整路径。

(base)>python C:\Users\username\python- for- excel\hello_world. py hello world!

# Anaconda Prompt 中的长文件路径

处理长文件路径的简便方法就是直接把文件拖放到你的 Anaconda Prompt 中。文件的完整路径会直接写入光标所在位置。

VS Code 中的 Anaconda Prompt

VS Code 中的 Anaconda Prompt 不必为了使用 Anaconda Prompt 而从 VS Code 中切换出去。在 VS Code 中可以直接通过快捷键 Ctrl+ `或者“查看 > 终端”菜单项显示集成终端。由于集成终端会在项目所在文件夹中打开，因此也不需要切换目录。

(base)> python hello_world. pyhello world!

VSCode 中的运行按钮

VS Code 中的运行按钮在 VS Code 中，有一种无须使用 Anaconda Prompt 也能运行代码的简单方法。在编辑 Python 文件时，你会在右上方看到一个播放图标，这就是运行文件按钮（参见图 2- 6）。点击这个按钮会自动在底部打开终端并运行代码。

# 在 VSCode 中打开文件

当你在资源管理器（位于活动栏）中单击一个文件时，VS Code 会有一些令人意外的默认行为。单击文件后，文件会以预览模式打开，意思就是说如果没有对这个文件进行更改，那么你下一次单击打开的文件会替换掉这个文件的标签页。如果想关掉单击操作的这种行为（变成单击选定文件，双击打开），可以在“首选项 > 设置”中（或者用快捷键，在 Windows 中是 Ctrl+，在 macOS 中是 Command- ，）将“工作台 > ‘List: Open Mode’”设置为“doubleClick”。

现在，你已经知道了如何在 VSCode 中创建、编辑和运行 Python 脚本。不过 VSCode 还有很多其他的本领，在附录 B 中，我会介绍如何使用调试器，以及如何在 VSCode 中运行 Jupyter 笔记本。

# 可选文本编辑器和 IDE

工具的选择因人而异，并不是说本书选用了 Jupyter 笔记本和 VSCode，你就不能选择其他的工具了。

下面是一些比较受欢迎的文本编辑器

SublimeText

Sublime 是一个高效的付费文本编辑器

Notepad++

Notepad++历史悠久且免费，不过仅适用于 Windows。

Vim 和 Emacs

Vim 和 Emacs 的学习曲线很陡峭，对于新手程序员来说可能并不是一个最佳选择，但是它们在专业程序员中很受欢迎。二者之间的竞争相当激烈，维基百科甚至称之为“编辑器大战”。

下面是一些热门 IDE。

PyCharm

PyCharmPyCharm 社区版功能强大且免费，付费的专业版额外提供了科学工具和 Web 开发的支持。

Spyder

SpyderSpyder 和 MATLAB 的 IDE 很像，带有变量浏览器。Anaconda 发行版附带了 Spyder，你可以在 Anaconda Prompt 中运行 spyder 命令体验一下。

JupyterLab

JupyterLabJupyterLab 是一个由 Jupyter 笔记本团队开发的基于 Web 的 IDE，当然你也可以用它来运行 Jupyter 笔记本。除此之外，它还试图整合数据科学工作所需要的所有工具。

WingPythonIDE

WingPythonIDEWingPythonIDE 是一个历史悠久的 IDE。它有免费的简化版和名为 WingPro 的付费版。

KomodoIDE

KomodoIDEKomodoIDE 是由 ActiveState 开发的商业 IDE，除了 Python，还支持很多其他语言。

PyDev

PyDev 是基于流行的 EclipseIDE 开发的一个 PythonIDE。

# 2.4 小结

本章介绍了如何安装和使用我们会用到的工具：Anaconda Prompt、Jupyter 笔记本和 VS Code。我们也在 Python REPL、Jupyter 笔记本和 VS Code 这 3 种环境中分别运行了一小段 Python 代码。

强烈建议要熟悉 Anaconda Prompt 的用法，习惯之后你就会发现它的强大之处。能在云端运行 Jupyter 笔记本也是非常舒适的体验，因为本书前 3 部分的示例代码都可以在云上运行。

开发环境准备就绪之后，现在你可以着手进入第 3 章了。在第 3 章中，你会学到本书需要用到的所有 Python 知识。