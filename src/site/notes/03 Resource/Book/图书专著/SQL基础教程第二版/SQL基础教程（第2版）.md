---
{"dg-publish":true,"dg-permalink":"book/27055712","permalink":"/book/27055712/","metatags":{"description":"本书是畅销书《SQL基础教程》第2版，介绍了关系数据库以及用来操作关系数据库的SQL语言的使用方法。书中通过丰富的图示、大量示例程序和详实的操作步骤说明，让读者循序渐进地掌握SQL的基础知识和使用技巧，切实提高编程能力。每章结尾设置有练习题，帮助读者检验对各章内容的理解程度。另外，本书还将重要知识点总结为“法则”，方便读者随时查阅。","og:site_name":"DavonOs","og:title":"SQL基础教程（第2版）","og:type":"book","og:url":"https://zuji.eu.org/book/27055712","og:image":"https://wfqqreader-1252317822.image.myqcloud.com/cover/871/26211871/t6_26211871.jpg","og:image:width":"50","og:image:alt":"bookcover"},"tags":["books/T工业技术/TP自动化技术、计算机技术"]}
---


| 封面                                                                     | 书名           | 作者     | 状态 | 评分       |
| ---------------------------------------------------------------------- | ------------ | ------ | -- | -------- |
| ![\|50](https://img3.doubanio.com/view/subject/l/public/s34971742.jpg) | SQL基础教程（第2版） | 日/MICK | \- | 9.2 ⭐⭐⭐⭐ |

{ .block-language-dataview}

# 第一章 数据库和SQL

本章重点

本章介绍了数据库的结构和基本理论，以及数据库的实际应用。大家可以学习到如何对关系数据库中用来存储数据的表进行创建、更新和删除操作，同时还能掌握关系数据库专用的SQL语句的书写方法和规则。

1-1. 数据库是什么

- 用来管理数据库的计算机系统称为数据库管理系统（DBMS）
- 通过使用DBMS，多个用户便可安全、简单地操作大量数据。
- 数据库有很多种类，本书将介绍如何使用专门的SQL语言来操作关系数据库。
- 关系数据库通过关系数据库管理系统（RDBMS）进行管理。

数据库（DB，DataBase）：将大量数据保存起来，通过计算机加工而成的可以进行高效访问的数据集合。

数据库管理系统（DBMS，Database Management System）：用来管理数据库的计算机系统。

为什么DBMS那么重要

文本文件或者电子制表软件的缺陷：无法多人共享数据、无法提供操作大量数据所需的格式、实现读写自动化需要编程能力、无法应对突发事故

DBMS可以克服以上不足，实现多个用户同时安全简单地操作大量数据。

DBMS的种类

通过数据的保存格式（数据库的种类）来进行分为以下5种类型：

层次数据库（HDB，Hierarchical Database）

关系数据库（RDB，Relational Database）

- 表1-1　关系数据库中的数据

| 商品编号 | 商品名称 | 商品种类 | 销售单价 | 进货单价 | 登记日期 |
| --- | --- | --- | --- | --- | --- |
| 0001 | T恤衫 | 衣服 | 1000 | 500 | 2009-09-20 |
| 0002 | 打孔器 | 办公用品 | 500 | 320 | 2009-09-11 |
| 0003 | 运动T恤  | 衣服 | 4000 | 2800 |  |
| 0004 | 菜刀 | 厨房用具 | 3000 | 2800 | 2009-09-20 |
| 0005 | 高压锅 | 厨房用具 | 6800 | 5000 | 2009-01-15 |
| 0006 | 叉子 | 厨房用具 | 500 |  | 2009-09-20 |
| 0007 | 擦菜板 | 厨房用具 | 880 | 790 | 2008-04-28 |
| 0008 | 圆珠笔 | 办公用品 | 100 |  | 2009-11-11 |


这种类型的 DBMS 称为关系数据库管理系统（RDBMS，Relational Database Management System）。

比较具有代表性的 RDBMS 有如下5种：

● Oracle Database：通常简称为 Oracle，甲骨文公司的RDBMS 

● SQL Server：微软公司的RDBMS 

● DB2：IBM公司的RDBMS

● PostgreSQL：开源的RDBMS 

● MySQL：开源的RDBMS

面向对象数据库（OODB，Object Oriented Database）

XML数据库（XMLDB，XML Database）

键值存储系统（KVS，Key-Value Store）

1-2. 数据库的结构

RDBMS的常见系统结构

最常见的系统结构就是客户端/服务器类型（C/S类型）

服务器指的是用来接收其他程序发出的请求，并对该请求进行相应处理的程序（软件），或者是安装了此类程序的设备（计算机）。在计算机上
持续执行处理，并等待接收下一条请求。RDBMS也是一种服务器，它能够从保存在硬盘上的数据库中读取数据并返回，还可以把数据变更为指定
内容。
与之相对，向服务器发出请求的程序（软件），或者是安装了该程序的设备（计算机）称为客户端。访问由RDBMS管理的数据库，进行数据
读写的程序称为RDBMS客户端。RDBMS客户端将想要获取什么样的数据，或者想对哪些数据进行何种变更等信息通过SQL语句发送给RDBMS服务器。RDBMS根据该语句的内容返回所请求的数据，或者对存储在数据库中的数据进行更新。

客户端就如同委托方，而服务器就像是受托方。由于两者关系类似受托方执行委托方发出的指令，故而得名。这样就可以使用SQL语句来实现关系数据库的读写操作了。
另外，RDBMS既可以和其客户端安装在同一台计算机上，也可以分别安装在不同的计算机上。不仅可以通过网络使二者相互关联，还可以实现多个客户端访问同一个RDBMS（图1-4）。

表的结构

用来管理数据的二维表在关系数据库中简称为表。根据SQL语句的内容返回的数据同样必须是二维表的形式 。

表的列（垂直方向）称为字段，它代表了保存在表中的数据项目。对列的约束比Excel更加严格，定义为数字的列只能输入数字，定义为日期的列只能输入日期（将在1-4节详细介绍）。

表的行（水平方向）称为记录，它相当于一条数据。关系数据库必须以行为单位进行数据读写。

行和列交汇的方格称为单元格。 一个单元格中只能输入一个数据  。

1-3.SQL概要

标准SQL/特定SQL

SQL语句及其种类

SQL用关键字、表名、列名等组合而成的一条语句（SQL语句）来描述操作的内容。

关键字：那些含义或使用方法已事先定义好的英语单词，存在包含“对表进行查询”或者“参考这个表”等各种意义的关键字。

根据对RDBMS赋予的指令种类（功能）不同，SQL语句可分为三类：

- DDL（数据定义语言，Data Definition Language）
    
    创建或删除存储数据用的数据库以及数据库中的表等对象。包含以下几种指令：
    `CREATE`： 创建数据库和表等对象
    `DROP`： 删除数据库和表等对象
    `ALTER`： 修改数据库和表等对象的结构
    
- DML（数据操纵语言，Data Manipulation Language）
    
    查询或变更表中的记录。包含以下几种指令：
    `SELECT`：查询表中的数据
    `INSERT`：向表中插入新数据
    `UPDATE`：更新表中的数据
    `DELETE`：删除表中的数据
    
- DCL（数据控制语言，Data Control Language）
    
    确认或取消对数据库中的数据进行的变更，还可以对RDBMS的用户是否有权限操作数据库中的对象（数据库表等）进行设定。包含以下几种指令：
    `COMMIT`： 确认对数据库中的数据进行的变更
    `ROLLBACK`： 取消对数据库中的数据进行的变更
    `GRANT`： 赋予用户操作权限
    `REVOKE`： 取消用户的操作权限
    

实际使用的SQL语句当中有90%属于DML。

SQL的基本书写规则

要以分号（;）结尾
一条SQL语句可以描述一个数据库操作。在RDBMS当中，SQL语句也是逐条执行的。众所周知，我们在句子的句尾加注标点表示结束，中文句子以句号（。）结尾，英文以点号（.）结尾，而SQL语句则使用分号（;）结尾。

不区分关键字的大小写 

不管写成SELECT还是select，解释都是一样的。表名和列名也是如此。虽然可以根据个人喜好选择大写还是小写（或大小写混杂），但为了理解起来更加容易，建议使用以下规则来书写SQL语句：
● 关键字大写
● 表名的首字母大写
● 其余（列名等）小写
插入到表中的具体数据是区分大小写的。例如，在操作过程中，数据Computer、COMPUTER 或computer，三者是不一样的。

常数的书写方式是固定的

在SQL语句中直接书写的字符串、日期或者数字等称为常数。

常数的书写方式：
书写字符串和日期常数需要使用单引号（'）括起来。
日期的格式有很多种（'26 Jan 2010' 或者 '10/01/26' 等），本书统一使用'2010-01-26' 这种'年-月-日'的格式。
书写数字常数无需任何符号标识，直接书写数字即可。

单词需要用半角空格或者换行来分隔

SQL语句的单词之间需使用半角空格或换行符来进行分隔。如下这种未加分隔的语句会发生错误，无法正常执行。
⭕CREATE TABLE Product
❌CREATETABLE Product
❌CREATE TABLEProduct
但是不能使用全角空格作为单词的分隔符，否则会发生错误，出现无法预期的结果。

## 1-4. 表的创建

### 数据库的创建（`CREATE DATABASE`语句）

在创建表之前，一定要先创建用来存储表的数据库。
运行`CREATE DATABASE`语句就可以在RDBMS上创建数据库了。语法如下：`CREATE DATABASE <数据库名称>;`
这里我们将数据库命名为 shop，然后执行SQL代码语句：`CREATE DATABASE shop;`
此外，数据库名称、表名以及列名都要使用半角字符（英文字母、数字、符号），具体内容随后会进行介绍。

### 表的创建（`CREATE TABLE`语句）

创建好数据库之后，接下来我们使用`CREATE TABLE`语句在其中创建表。语法如下：

```sql
CREATE TABLE <表名>
（<列名1> <数据类型> <该列所需约束>，
<列名2> <数据类型> <该列所需约束>，
<列名3> <数据类型> <该列所需约束>，
<列名4> <数据类型> <该列所需约束>，
…
<该表的约束1>， <该表的约束2>，……）；
```

该语法清楚地描述了我们要创建一个包含<列名1>、<列名2>、 ……的名称为<表名>的表，非常容易理解。每一列的数据类型（后述）是必
须要指定的，还要为需要的列设置约束（后述）。约束可以在定义列的时候进行设置，也可以在语句的末尾进行设置。

在数据库中创建[表 1-2 中的商品表](SQL基础教程（第2版）.md)（Product 表）

```sql
CREATE TABLE Product
(product_id      CHAR(4)      NOT NULL,
product_name     VARCHAR(100) NOT NULL,
product_type     VARCHAR(32)  NOT NULL,
sale_price       INTEGER      ,
purchase_price   INTEGER      ,
regist_date      DATE         ,
PRIMARY KEY (product_id));
```

### 命名规则

名称必须以半角英文字母开头 。

在同一个数据库中不能创建两个相同名称的表，在同一个表中也不能创建两个名称相同的列。如果出现这样的情况，RDBMS会返回错误信息。

只能使用半角英文字母、数字、下划线（）作为数据库、表和列的名称  。不能将 product_id 写成 product-id，因为标准SQL并不允许使用连字符作为列名等名称。$、#、?这样的符号同样不能作为名称使用。尽管有些RDBMS允许使用上述符号作为列的名称，但不能保证在其他RDBMS中也能使用。

### 数据类型的指定

Product表所包含的列，定义在`CREATE TABLE Product()`的括号中。列名右边的`INTEGER`或者`CHAR`等关键字，是用来声明该列的数据类型的，所有的列都必须指定数据类型。

数据类型表示数据的种类，包括数字型、字符型和日期型等。每一列都不能存储与该列数据类型不符的数据。声明为整数型的列中不能存储'abc'这样的字符串，声明为字符型的列中也不能存储1234这样的数字。 数据类型的种类很多，各个RDBMS之间也存在很大差异。根据业务需要实际创建数据库时，一定要根据不同的RDBMS选用最恰当的数据类型。

四种基本的数据类型

**INTEGER型**：指定存储整数的列的数据类型（数字型），不能存储小数。

**CHAR型**：CHAR是CHARACTER（字符）的缩写，是用来指定存储字符串的列的数据类型（字符型）。可以像`CHAR(10)`或者`CHAR(200)`这样，在括号中指定该列可以存储的字符串的长度（最大长度）。字符串超出最大长度的部分是无法输入到该列中的。RDBMS不同，长度单位也不一样，既存在使用字符个数的情况，也存在使用字节长度的情况。

字符串以定长字符串的形式存储在被指定为CHAR型的列中。所谓定长字符串，就是当列中存储的字符串长度达不到最大长度的时候，使用半角空格进行补足。例如，我们向`CHAR(8)`类型的列中输入`'abc'`的时候， 会以`'abc     '`（abc后面有5个半角空格）的形式保存起来。 另外，虽然之前我们说过SQL不区分英文字母的大小写，但是表中存储的字符串却是区分大小写的。也就是说，'ABC'和'abc'代表了两 个不同意义的字符串。

**VARCHAR型**：指定存储字符串的列的数据类型（字符串类型），也可以通过括号内的数字来指定字符串的长度（最大长度）。但该类型的列是以可变长字符串的形式来保存字符串的。定长字符串在字符数未达到最大长度时会用半角空格补足，但可变长字符串不同，即使字符数未达到最大长度，也不会用半角空格补足。例如，我们向`VARCHAR(8)`类型的列中输入字符串`'abc'`的时候，保存的就是字符串`'abc'`。

该类型的列中存储的字符串也和CHAR类型一样，是区分大小写的。

特定的SQL——Oracle中使用VARCHAR2型（Oracle中也有VARCHAR这种数据类型，但并不推荐使用）。

**DATE型**：指定存储日期（年月日）的列的数据类型（日期型）。

特定的SQL——除了年月日之外，Oracle中使用的DATE型还包含时分秒，但在本书中我们只学习日期部分。

### 约束的设置

约束是除了数据类型之外，对列中存储的数据进行限制或者追加条件的功能。Product表中设置了两种约束。

数据类型的右侧设置了NOT NULL 约束。NULL 是代表空白（无记录）的关键字A。在NULL之前加上了表示否定的NOT，就是给该列
设置了不能输入空白，也就是必须输入数据的约束（如果什么都不输入就会出错）。

这样一来，Product表的product_id（商品编号）列、product_name（商品名称）列和product_type（商品种类）列就都成了必须输入的项目。另外，在创建Product表的CREATE TABLE语句的后面，还有这样的记述：

`PRIMARY KEY (product_id)`

这是用来给product_id列设置主键约束的。所谓键，就是在指定特定数据时使用的列的组合。键种类多样，主键（primary key）就是可以特定一行数据的列B。也就是说，如果把product_id列指定为主键，就可以通过该列取出特定的商品数据了。

反之，如果向product_id列中输入了重复数据，就无法取出唯一的特定数据了（因为无法确定唯一的一行数据）。这样就可以为某一列设置主键约束了。

## 1-5. 表的删除和更新

### 表的删除

`DROP TABLE <表名>；`如果想要删除Product表，只需要`DROP TABLE Product;`

请大家务必注意！删除的表是无法恢复的。在执行该语句之前请务必仔细确认。即使是被误删的表，也无法恢复，只能重新创建，然后重新插入数据。

### 表定义的更新

有时好不容易把表创建出来之后才发现少了几列，其实这时无需把表删除再重新创建，只需使用变更表定义的ALTER TABLE语句就可以了。
下面就给大家介绍该语句通常的使用方法。

添加列时的语句：

`ALTER TABLE <表名> ADD COLUMN <列的定义>；`

特定的SQL

Oracle和SQL Server中不用写COLUMN。`ALTER TABLE <表名> ADD <列名>;`
另外，在Oracle中同时添加多列的时候，可以这样使用括号：`ALTER TABLE <表名> ADD (<列名>，<列名>，……);`
例如，我们可以在Product表中添加这样一列，product_name_pinyin（商品名称（拼音）），该列可以存储100位的可变长字符串。
DB2 PostgreSQL MySQL：`ALTER TABLE Product ADD COLUMN product_name_pinyin VARCHAR(100);`
Oracle：`ALTER TABLE Product ADD (product_name_pinyin VARCHAR2(100));`
SQL Server：`ALTER TABLE Product ADD product_name_pinyin VARCHAR(100);`

反之，删除表中某列使用的语句：
`ALTER TABLE <表名> DROP COLUMN <列名>；`

ALTER TABLE语句和DROP TABLE语句一样，执行之后无法恢复。误添的列可以通过 ALTER TABLE语句删除，或者将表全部删除之后重新再创建。

### 向Product表中插入数据

向Product表中插入数据的SQL语句

```sql
BEGIN TRANSACTION;
INSERT INTO Product VALUES ('0001', 'T恤衫', '衣服', 1000, 500, '2009-09-20');
INSERT INTO Product VALUES ('0002', '打孔器', '办公用品', 500, 320, '2009-09-11');
INSERT INTO Product VALUES ('0003', '运动T恤', '衣服', 4000, 2800, NULL);
INSERT INTO Product VALUES ('0004', '菜刀', '厨房用具', 3000, 2800, '2009-09-20');
INSERT INTO Product VALUES ('0005', '高压锅', '厨房用具', 6800, 5000, '2009-01-15');
INSERT INTO Product VALUES ('0006', '叉子', '厨房用具', 500, NULL, '2009-09-20');
INSERT INTO Product VALUES ('0007', '擦菜板', '厨房用具', 880, 790, '2008-04-28');
INSERT INTO Product VALUES ('0008', '圆珠笔', '办公用品', 100, NULL,'2009-11-11');
COMMIT;
```

特定的SQL
DBMS不同，DML语句也略有不同。在MySQL中运行时，需要把`BEGIN TRANSACTION;`改写成`START TRANSACTION;`
在Oracle和DB2中运行时，无需使用`BEGIN TRANSACTION;`（请予以删除）。

使用插入行的指令语句INSERT，就可以把表1-2中的数据都插入到表中了。开头的BEGIN TRANSACTION语句是开始插入行的指令语句，结尾的COMMIT语句是确定插入行的指令语句。这些指令语句将会在第4章详细介绍，大家不必急于记住这些语句。

### 表的修改

本节将名为Product的表作为例子进行了讲解，估计会有些读者在匆忙中把表名误写成了Poduct，创建出了名称错误的表，这可怎么办呢？ 如果还没有向表中插入数据，那么只需要把表删除，再重新创建一个名称正确的表就可以了。可是如果在发现表名错误之前就已经向表中插入了大量数据，再这样做就麻烦了。毕竟插入大量的数据既费时又费力。抑或起初决定好的表名，之后又觉得不好想换掉，这种情况也很麻烦。

其实很多数据库都提供了可以修改表名的指令`(RENAME)`来解决这样的问题。例如，如果想把Poduct表的名称变为Product，可以使用代码：
Oracle PostgreSQL：`ALTER TABLE Poduct RENAME TO Product;`
DB2：`RENAME TABLE Poduct TO Product;`
SQL Server：`sp_rename 'Poduct', 'Product';`
MySQL：`RENAME TABLE Poduct to Product;`
通常在RENAME之后按照<变更前的名称>、<变更后的名称>的顺序来指定表的名称。

各个数据库的语法都不尽相同，是因为标准SQL并没有RENAME，于是各个数据库便使用了各自惯用的语法。如上所述，在创建了错误的表名，或者想要保存表的备份时，使用这些语句非常方便。但美中不足的是，由于各个数据库的语法不同，很难一下子想出恰当的指令。这时大家就可以来参考本专栏。

## 练习题

1.1 编写一条 CREATE TABLE 语句，用来创建一个包含表1-A 中所列各项的表 Addressbook（地址簿），并为 regist_no（注册编号）列设置主键约束。

表1-A表Addressbook（地址簿）中的列

| 列的含义 | 列的名称 | 数据类型 | 约束 |
| --- | --- | --- | --- |
| 注册编号 | regist_no | 整数型 | 不能为NULL、主键 |
| 姓名 | name | 可变长字符串类型（长度为128） | 不能为NULL |
| 住址 | address | 可变长字符串类型（长度为256） | 不能为NULL |
| 电话号码 | tel_no | 定长字符串类型（长度为10） |  |
| 邮箱地址 | mail_address | 定长字符串类型（长度为20） |  |

1.2假设在创建练习1.1中的Addressbook表时忘记添加如下一列postal_ code（邮政编码）了，请把此列添加到Addressbook表中。
列名：postal_code
数据类型：定长字符串类型（长度为8）
约束：不能为 NULL

1.3编写 SQL 语句来删除 Addressbook 表。

```sql
CREATE TABLE Addressbook
(regist_no    INTEGER      NOT NULL,
name          VARCHAR(128) NOT NULL,
address       VARCHAR(256) NOT NULL,
tel_no        CHAR(10)     ,
mail_adress   CHAR(20)     ,
PRIMARY KEY (regist_no));

ALTER TABLE Addressbook ADD COLUMN postal_code char(8) NOT NULL;

DROP TABLE Addressbook;
```

# 第二章 查询基础

在Product表中数据查询的SQL语句。 执行查询时指定想要查询数据的条件。查询时可以指定一个或多个查询条件。

## 2-1. SELECT语句基础

列的查询

从表中选取数据时需要使用SELECT语句，也就是只从表中选出（SELECT）必要数据的意思。通过SELECT语句查询并选取出必要数据的过程称为匹配查询或查询（query）。 SELECT语句是SQL语句中使用最多的最基本的SQL语句。掌握了SELECT语句，距离掌握SQL语句就不远了。

SELECT语句的基本语法如下：

```sql

SELECT <列名>，……
	FROM <表名>；

```

该SELECT 语句包含了SELECT 和FROM 两个子句（clause）。子句是 SQL 语句的组成要素，是以 SELECT 或者 FROM 等作为起始的短语。
SELECT子句中列举了希望从表中查询出的列的名称，而FROM子句则指定了选取出数据的表的名称。

接下来，我们尝试从第1章创建出的Product（商品）表中，查询出图2-1所示的 product_id（商品编号）列、product_name（商品名称）列和purchase_price（进货单价）列。

```sql
SELECT product_id, product_name, purchase_price
	FROM Product;
>>>
product_id | product_name |purchase_price
-----------+--------------+---------------
0001 |T恤衫                | 500
0002 |打孔器               | 320
0003 |运动T恤              | 2800
0004 |菜刀                 | 2800
0005 |高压锅               | 5000
0006 |叉子                 | null
0007 |擦菜板               | 790
0008 |圆珠笔               | null
```

查询表中所有的列

为列设定别名

常数的查询

从结果中删除重复行

根据WHERE语句来选择记录

注释的书写方法

2-2　算术运算符和比较运算符

算术运算符

需要注意NULL

比较运算符

对字符串使用不等号时的注意事项

不能对NULL使用比较运算符

2-3　逻辑运算符

NOT运算符

AND运算符和OR运算符

使用括号强化处理

逻辑运算符和真值

含有NULL时的真值

# 第三章|聚合与排序

随着表中记录（数据行）的不断积累，存储数据逐渐增加，有时我们可能希望计算出这些数据的合计值或者平均值等。本章我们将学习使用SQL语句进行汇总操作的方法。此外，我们还会学习在汇总操作时指定条件，以及对汇总结果进行升序、降序的排序方法。

3-1.对表进行聚合查询
聚合函数
计算表中数据的行数
计算NULL之外的数据的行数
计算合计值
计算平均值
计算最大值和最小值
使用聚合函数删除重复值（关键字DISTINCT）

3-2.对表进行分组
GROUP BY子句
聚合键中包含NULL的情况
使用WHERE子句时GROUP BY的执行结果
与聚合函数和GROUP BY子句有关的常见错误

3-3.为聚合结果指定条件
HAVING子句
HAVING子句的构成要素
相对于HAVING子句，更适合写在WHERE子句中的条件

3-4.对查询结果进行排序
ORDER BY子句
指定升序或降序
指定多个排序键
NULL的顺序
在排序键中使用显示用的别名
ORDER BY子句中可以使用的列
不要使用列编号