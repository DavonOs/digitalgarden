---
{"dg-publish":true,"dg-permalink":"books/36667204/09","permalink":"/books/36667204/09/","metatags":{"description":"还记得第 8 章中提到的那个专注于户外运动的巨头公司吗？对，那个旗下有 20 个品牌、涉及 128 个类目（行业）的公司。作为这家公司的数据分析师，你又收到了老板的消息：“有个很重要且紧急的需求，公司准备根据类目发展趋势对资源分配进行重大调整。你帮我看一下，根据上次的数据，有哪些细分行业发展比较好，将来可能有更多的机会。”","og:site_name":"DavonOs","og:title":"第9章 行业机会分析与权重确定","og:type":"article","og:url":"https://zuji.eu.org/books/36667204/09","og:image":"https://www.manongbook.com/d/file/python/443a2b6d4941d5d585d6de383da2155d0.jpg","og:image:width":"200","og:image:alt":"articlecover","og:locale":"zh_cn"},"dgShowInlineTitle":true,"created":"2025-09-04 12:26","updated":"2025-09-06 19:51"}
---

## 9.1 案例背景介绍

还记得第 8 章中提到的那个专注于户外运动的巨头公司吗？对，那个旗下有 20 个品牌、涉及 128 个类目（行业）的公司。作为这家公司的数据分析师，你又收到了老板的消息：“有个很重要且紧急的需求，公司准备根据类目发展趋势对资源分配进行重大调整。你帮我看一下，根据上次的数据，有哪些细分行业发展比较好，将来可能有更多的机会。”

你对数据源充满疑惑：“老板，可是我只有我们自己品牌的相关类目数据，看整体类目发展趋势，还要有其他竞争品牌的数据吧？”

老板很轻蔑地说：“这些行业竞争对手不值一提，我们这些品牌的销售额是可以代表整个行业的。不说了，我马上还有个会议。哦，对了，这个需求非常重要。你可以参考之前的思路。”

## 9.2 传统的解题方法

### 之前的传统思路

很久以前你曾处理过类似于“哪些细分类目发展趋势好”的需求，那时你刚入职不久，对于这种模糊需求没有什么头绪，你主要抓住了两个重点：

1）采用销售增速作为衡量发展趋势的指标；2）筛选出每个大类目下销售增速最快的细分类目，照顾到每个大类目。最终结果还不错，你从中发现了一些趋势。不过，当时你的所有操作都是基于 Excel 进行的，花了非常长的时间，而现在你可以用 Pandas 来快速实现。

### 数据预览和汇总

我们的数据依然是之前的 128 张行业数据，每张表都包含日期、品牌、访客数、转化率、客单价、类目等字段，如下所示。

<table><tr><td>日期</td><td>品牌</td><td>访客数</td><td>转化率</td><td>客单价</td><td>三级类目</td><td>详细类目</td></tr><tr><td>2023-12</td><td>品牌-17</td><td>343731</td><td>0.030085833</td><td>40</td><td>绑钩器</td><td>垂钓装备&amp; amp; 绑钩器</td></tr><tr><td>2023-12</td><td>品牌-12</td><td>21850</td><td>0.022895508</td><td>286</td><td>绑钩器</td><td>垂钓装备&amp; amp; 绑钩器</td></tr><tr><td>2023-12</td><td>品牌-20</td><td>117047</td><td>0.076255288</td><td>14</td><td>绑钩器</td><td>垂钓装备&amp; amp; 绑钩器</td></tr><tr><td>2023-12</td><td>品牌-13</td><td>132785</td><td>0.01854347</td><td>50</td><td>绑钩器</td><td>垂钓装备&amp; amp; 绑钩器</td></tr><tr><td>2023-12</td><td>品牌-1</td><td>37010</td><td>0.045507188</td><td>54</td><td>绑钩器</td><td>垂钓装备&amp; amp; 绑钩器</td></tr></table>

要实现最终的需求，首先需要按照类目和年份来汇总数据。参考第 8 章中批量处理的代码逻辑，只需要调整每个类目下的汇总逻辑即可。

result  =  pd.DataFrame ()

遍历表格名称

```
for name in os.listdir (): df  $=$  pd. read_excel（name) #提取年度标签 ，即 2022 或 2023 df['年份']  $=$  df['日期']. str[: 4] df['销售额  $\mathrm{\bf\Phi}^{\prime}\mathrm{\bf\Phi}^{\prime}\mathrm{\bf\Phi} = \mathrm{\bf\Phi}$  df['访客数']\*df['转化率']\*df['客单价'] #每个行业 （类目）数据内，按照年度汇总 df_sum  $=$  df. groupby（'年份')['销售额']. sum（). reset_index（) df_sum['类目']  $=$  name. replace（'. xlsx',') result  $=$  pd.concat ([result, df_sum])
```

result.head ()

运行结果如下：

<table><tr><td>年份</td><td>销售额</td><td>类目</td><td></td></tr><tr><td>0</td><td>2022</td><td>7884578.41</td><td>专项户外运动装备&amp; amp; 冰爪</td></tr><tr><td>1</td><td>2023</td><td>30163749.95</td><td>专项户外运动装备&amp; amp; 冰爪</td></tr><tr><td>0</td><td>2022</td><td>7173132.43</td><td>专项户外运动装备&amp; amp; 呼吸管-呼吸器</td></tr><tr><td>1</td><td>2023</td><td>17198793.49</td><td>专项户外运动装备&amp; amp; 呼吸管-呼吸器</td></tr><tr><td>0</td><td>2022</td><td>19393866.43</td><td>专项户外运动装备&amp; amp; 安全带</td></tr></table>

已经得到了每个类目下 2022 年和 2023 年各自的销售额数据。为了使数据更好处理，这里按照类目和年份做一个透视。

```
final = pd. pivot_table (result, index = '类目', columns = '年份', values = '销售额', aggfunc = 'sum'). reset_index () final. columns=['类目', '2022 年销售额', '2023 年销售额']print (final)
```

运行结果如下：

<table><tr><td></td><td></td><td>类目</td><td>2022 年销售额</td><td>2023 年销售额</td></tr><tr><td>0</td><td>专项户外运动装备&amp; amp; 冰爪</td><td>7884578.41</td><td>30163749.95</td><td></td></tr><tr><td>1</td><td>专项户外运动装备&amp; amp; 呼吸管-呼吸器</td><td>7173132.43</td><td>17198793.49</td><td></td></tr><tr><td>2</td><td>专项户外运动装备&amp; amp; 安全带</td><td>19393866.43</td><td>66140160.84</td><td></td></tr><tr><td>3</td><td>专项户外运动装备&amp; amp; 救生衣</td><td>23820417.15</td><td>98807893.65</td><td></td></tr><tr><td>4</td><td>专项户外运动装备&amp; amp; 气瓶</td><td>8052409.00</td><td>36317479.97</td><td></td></tr><tr><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td></tr><tr><td>123</td><td>防护-救生装备&amp; amp; 防护面罩</td><td>3464970.97</td><td>11843236.83</td><td></td></tr><tr><td>124</td><td>防潮垫-地席-枕头&amp; amp; 地布-地席</td><td>3828998.31</td><td>12738643.79</td><td></td></tr><tr><td>125</td><td>防潮垫-地席-枕头&amp; amp; 枕头</td><td>52704583.51</td><td>214983856.48</td><td></td></tr><tr><td>126</td><td>防潮垫-地席-枕头&amp; amp; 防潮垫</td><td>64294811.64</td><td>260637588.07</td><td></td></tr><tr><td>127</td><td>防潮垫-地席-枕头&amp; amp; 防潮垫-地席-枕头</td><td>114956693.58</td><td>434554583.83</td><td></td></tr></table>

### 每个类目增长最快的细分类目

看每个细分类目的增长，首先要计算出增速。

```
final['销售增速'] = (final['2023 年销售额'] - final['2022 年销售额']) / final['2022 年销售额']final.head ()
```

运行结果如下：

<table><tr><td></td><td>类目</td><td>2022 年销售额</td><td>2023 年销售额</td><td>销售增速</td></tr><tr><td>0</td><td>专项户外运动装备&amp; amp; 冰爪</td><td>7884578.41</td><td>30163749.95</td><td>2.83</td></tr><tr><td>1</td><td>专项户外运动装备&amp; amp; 呼吸管-呼吸器</td><td>7173132.43</td><td>17198793.49</td><td>1.40</td></tr><tr><td>2</td><td>专项户外运动装备&amp; amp; 安全带</td><td>19393866.43</td><td>66140160.84</td><td>2.41</td></tr><tr><td>3</td><td>专项户外运动装备&amp; amp; 救生衣</td><td>23820417.15</td><td>98807893.65</td><td>3.15</td></tr><tr><td>4</td><td>专项户外运动装备&amp; amp; 气瓶</td><td>8052409.00</td><td>36317479.97</td><td>3.51</td></tr></table>

为了方便排序，提取出大类目和对应的细分类目，这里按照类目字段的&分隔符来提取。

```
final['大类目'] = final['类目']. str.split (&'). str[0]final['细分类目'] = final['类目']. str.split (&'). str[1]final.head ()
```

把类目字段按照&符号切分成两段，大类目取前面的字段，细分类目则取后面的字段，结果如下：

<table><tr><td></td><td>类目</td><td>2022 年销售额</td><td>2023 年销售额</td><td>销售增速</td><td>大类目</td><td>细分类目</td></tr><tr><td>0</td><td>专项户外运动装备&amp; amp; 冰爪</td><td>7884578.41</td><td>30163749.95</td><td>2.83</td><td>专项户外运动装备</td><td>冰爪</td></tr><tr><td>1</td><td>专项户外运动装备&amp; amp; 呼吸管-呼吸器</td><td>7173132.43</td><td>17198793.49</td><td>1.40</td><td>专项户外运动装备</td><td>呼吸管-呼吸器</td></tr><tr><td>2</td><td>专项户外运动装备&amp; amp; 安全带</td><td>19393866.43</td><td>66140160.84</td><td>2.41</td><td>专项户外运动装备</td><td>安全带</td></tr><tr><td>3</td><td>专项户外运动装备&amp; amp; 救生衣</td><td>23820417.15</td><td>98807893.65</td><td>3.15</td><td>专项户外运动装备</td><td>救生衣</td></tr><tr><td>4</td><td>专项户外运动装备&amp; amp; 气瓶</td><td>8052409.00</td><td>36317479.97</td><td>3.51</td><td>专项户外运动装备</td><td>气瓶</td></tr></table>

接下来，为了筛选出每个大类目下增速最快的细分类目，先按照每个大类目下细分类目的销售增速进行降序排列：

```
r = final. sort_values (['大类目', '销售增速'], ascending = False)r.head ()
```

运行结果如下：

<table><tr><td></td><td>类目</td><td>2022 年销售额</td><td>2023 年销售额</td><td>销售增速</td><td>大类目</td><td>细分类目</td></tr><tr><td>125</td><td>防潮垫-地头&amp; amp; 枕头&amp; amp; 枕头</td><td>52704383.51</td><td>214983836.48</td><td>3.08</td><td>防潮垫-地头-枕头</td><td>枕头</td></tr><tr><td>126</td><td>防潮垫-地席-枕头&amp; amp; 防潮垫</td><td>64294811.64</td><td>260637588.07</td><td>3.05</td><td>防潮垫-地席-枕头</td><td>防潮垫</td></tr><tr><td>127</td><td>防潮垫-地头&amp; amp; 防潮垫-地席-枕头</td><td>114956693.58</td><td>434554583.83</td><td>2.78</td><td>防潮垫-地席-枕头</td><td>防潮垫-地席-枕头</td></tr><tr><td>124</td><td>防潮垫-地席-枕头&amp; amp; 地头-地席</td><td>3828998.31</td><td>12738643.79</td><td>2.33</td><td>防潮垫-地席-枕头</td><td>地市-地席</td></tr><tr><td>122</td><td>防护-救生装备&amp; amp; 防护-救生装备</td><td>103906995.09</td><td>516112688.85</td><td>3.97</td><td>防护-救生装备</td><td>防护-救生装备</td></tr></table>

最后，筛选出每个大类目下增速排序第一的数据即可。用 groupby（）和 head（）的组合，十分方便。

r.groupby ('大类目'). head (1)

结果如图 9-1 所示  

<table><tr><td colspan="4">类目 2022 年销售额 2023 年销售额销售增速</td><td>大类目</td><td>细分类目</td></tr><tr><td>防潮垫-地基-枕头&amp; amp; 枕头</td><td>52704583.51</td><td>21498356.48</td><td>3.08</td><td>防潮垫-地基-枕头</td><td>枕头</td></tr><tr><td>防护-救生装备&amp; amp; 防护-救生装备</td><td>103906995.09</td><td>516112688.85</td><td>3.97</td><td>防护-救生装备</td><td>防护-救生装备</td></tr><tr><td>睡袋&amp; amp; 睡袋</td><td>193959076.88</td><td>594014206.98</td><td>2.06</td><td>睡袋</td><td>睡袋</td></tr><tr><td>登山杖-手杖&amp; amp; 登山杖-手杖</td><td>77763133.79</td><td>295317365.32</td><td>2.80</td><td>登山杖-手杖</td><td>登山杖-手杖</td></tr><tr><td>洗漱清洁-护理用品&amp; amp; 防虫-防蚊用品</td><td>223484997.36</td><td>75632462.16</td><td>2.22</td><td>洗漱清洁-护理用品</td><td>防虫-防蚊用品</td></tr><tr><td>望远镜-夜视仪-户外眼镜&amp; amp; 望远镜-夜视仪-户外眼镜</td><td>220271388.35</td><td>1025433112.52</td><td>3.66</td><td>望远镜-夜视仪-户外眼镜</td><td>望远镜-夜视仪-户外眼镜</td></tr><tr><td>旅行便携装备&amp; amp; 晾衣绳</td><td>4306504.60</td><td>18455947.82</td><td>3.29</td><td>旅行便携装备</td><td>晾衣绳</td></tr><tr><td>户外鞋靴&amp; amp; 滑雪鞋-雪地靴</td><td>79046497.00</td><td>364683981.78</td><td>3.61</td><td>户外鞋靴</td><td>滑雪鞋-雪地靴</td></tr><tr><td>户外照明&amp; amp; 营地灯-帐篷灯</td><td>21839003.61</td><td>104666693.76</td><td>3.79</td><td>户外照明</td><td>营地灯-帐篷灯</td></tr><tr><td>户外服装&amp; amp; 抓绒衣</td><td>101650296.49</td><td>454712444.95</td><td>3.47</td><td>户外服装</td><td>抓绒衣</td></tr><tr><td>户外休闲家具&amp; amp; 户外桌椅套</td><td>14235575.41</td><td>66832433.35</td><td>3.69</td><td>户外休闲家具</td><td>户外桌椅套装</td></tr><tr><td>垂钓装备&amp; amp; 鱼钩</td><td>55895341.31</td><td>299165733.63</td><td>4.35</td><td>垂钓装备</td><td>鱼钩</td></tr><tr><td>专项户外运动装备&amp; amp; 气瓶</td><td>8052409.00</td><td>36317479.97</td><td>3.51</td><td>专项户外运动装备</td><td>气瓶</td></tr></table>

图 9-1 筛选出的细分趋势类目

根据上一步大类目- 销售增速排序后的结果，用 groupby（‘大类目’）. head（1）得到每个大类目分组下排序第一的细分类目，并返回数据本身，即每个大类目下增速排名第一的细分类目。

## 9.3 权重确定方法

对于“有哪些细分类目发展比较好”的需求，能不能为销售额、增速等关键指标赋予不同的权重，最终计算出一个类似于发展指数的综合指标呢？答案是肯定的。

在这一节，我们先了解有哪些确定权重的方法。

### 级别法

级别法，即根据自己的经验和主观判断来决定权重大小。它也常叫作拍脑袋法，可以说是实际中最常用的权重确定方法了。

举个例子，假如某业务方要做一个分析，涉及确定 2022 年和 2023 年各自年份销售额的权重，应该定多少合适呢？

实习生级别：“我觉得 2023 年是更近的年份，对现在的影响更大，应该权重更高，因此 2022 年权重可以是 0.4，2023 年权重是 0.6。”

业务方：“你没什么经验，不能太主观了，为什么 2023 年的权重是 0.6，而不是 0.65？”

专家级别：“之前有过类似的场景，2022 年和 2023 年权重分别是 0.4 和 0.6，在这里可以沿用。”

业务方：“我记不太清之前是怎么确定的，不过既然有过往经验，也可以用起来。”

老板级别：“基于我的多年行业经验和二八法则等经典理论，我认为，2022 年和 2023 年增速的权重，就应该是 0.4 和 0.6。”

业务方：“既然是老板说的，一定有他的专业判断，0.4 和 0.6 看上去非常科学。”

之所以我把这种方法叫作级别法，是因为级别法的效果很容易受使用者级别的影响，且级别越高越不容易被质疑。上面的例子便是明证。

### 权值因子判表法

权值因子判表法也属于主观赋权法的一种。但这种方法在专家意见、多方权衡和相对量化等方面有一定的优势，结论的可信度也更高。

举一个具体的案例：要找对象，相貌、身材、涵养、家庭背景的重要度应该怎么量化和排序？婚恋公司召集了 4 个极其权威的情感专家，要通过权值因子判表法来解决这个问题。

首先，结合 4 个考量维度，为每个专家制定判表，如图 9- 2 所示。

其次，把每张表分发至专家，让其独立完成打分。打分逻辑很简单，用行的属性和列的属性做比较，如果认为行属性比对应的列属性更重要，则填上 1，否则填 0，如图 9- 3 所示。

<table><tr><td>专家 1</td><td>相貌</td><td>身材</td><td>涵养</td><td>家庭背景</td></tr><tr><td>相貌</td><td></td><td></td><td></td><td></td></tr><tr><td>身材</td><td></td><td></td><td></td><td></td></tr><tr><td>涵养</td><td></td><td></td><td></td><td></td></tr><tr><td>家庭背景</td><td></td><td></td><td></td><td></td></tr></table>

<table><tr><td>专家 2</td><td>相貌</td><td>身材</td><td>涵养</td><td>家庭背景</td><td></td></tr><tr><td>相貌</td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>身材</td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>涵养</td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>家庭背景</td><td></td><td></td><td></td><td colspan="2"></td></tr></table>

<table><tr><td>专家 3</td><td>相貌</td><td>身材</td><td>涵养</td><td>家庭背景</td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>相貌</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>身材</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>涵养</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>家庭背景</td><td></td><td></td><td></td><td></td><td>专家 4</td><td>相貌</td><td>身材</td><td>涵养</td><td>家庭背景</td></tr><tr><td>相貌</td><td></td><td></td><td></td><td></td><td>相貌</td><td></td><td></td><td></td><td></td></tr><tr><td>身材</td><td></td><td></td><td></td><td></td><td>身材</td><td></td><td></td><td></td><td></td></tr><tr><td>涵养</td><td></td><td></td><td></td><td></td><td>涵养</td><td></td><td></td><td></td><td></td></tr><tr><td>家庭背景</td><td></td><td></td><td></td><td></td><td>家庭背景</td><td></td><td></td><td></td><td></td></tr></table>

图 9-2 打分表样例

<table><tr><td>专家 4</td><td>相貌</td><td>身材</td><td>涵养</td><td>家庭背景</td><td></td></tr><tr><td>相貌</td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>身材</td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>涵养</td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>家庭背景</td><td></td><td></td><td></td><td></td><td></td></tr></table>

<table><tr><td>专家 1</td><td>相貌</td><td>身材</td><td>涵养</td><td>家庭背景</td></tr><tr><td>相貌</td><td></td><td>→1</td><td>0</td><td>0</td></tr><tr><td>身材</td><td>0</td><td></td><td>0</td><td>0</td></tr><tr><td>涵养</td><td>1</td><td>1</td><td></td><td>1</td></tr><tr><td>家庭背景</td><td>1</td><td>1</td><td>0</td><td></td></tr></table>

图 9-3 单张打分表释义

这些属性不会和自身相比，所以对角线一栏是空值。我们重点对右上角区域进行打分，因为左下角的打分是右上角的逻辑对称（但也会参与计算）。

比如认为相貌比身材重要，打 1 分，与之对应，在身材和相貌对比的单元格打 0 分。

根据专家 1 的打分表，他认为：

口相貌比身材重要，但没有涵养和家庭背景重要；

口身材自然也没有涵养和家庭背景重要；

口涵养比家庭背景重要。

综合来看，专家 1 认为，涵养  $>$  家庭背景  $>$  相貌  $>$  身材（  $>$  表示前者比后者重要）。

其他专家打分的逻辑也一样。打完分后我们行向求和，得到每位的分值汇总，如图 9- 4 所示。

最后，结合 4 位专家的打分，求平均分。例如，相貌平均分如图 9- 5 所示。

求其他平均分的逻辑完全一样。最终，求得身材、涵养、家庭背景的平均分分别是 2、2.25 和 0.75。

![](https://cdn-mineru.openxlab.org.cn/result/2025-09-04/4e9d3456-c4c4-446b-8bbe-de35fe55fbe4/3e6ffdc0086fd041e2f9f793df8fc4835667bd96ef7d8bda84b427f552085a21.jpg)  
图 9-4 专家打分结果

![](https://cdn-mineru.openxlab.org.cn/result/2025-09-04/4e9d3456-c4c4-446b-8bbe-de35fe55fbe4/67ce534c9ea197b2402ceed8cb7a209429b9ad728b71174b0879b50d8d78d1b3.jpg)  
图 9-5 相貌平均分

由于权重之和一般是 1，计算各属性对应的权重时，用其平均分除以平均分之和即可，如图 9- 6 所示。

![](https://cdn-mineru.openxlab.org.cn/result/2025-09-04/4e9d3456-c4c4-446b-8bbe-de35fe55fbe4/06e2782d1d4ae3087e875cb9b2a1ba05a608954bb5f782cbcf97c229bb20f31f.jpg)  
图 9-6 各维度打分逻辑及结果

可见，对于这 4 位专家而言，4 个维度的重要度排序是涵养  $\gimel$  身材  $\gimel$  相貌  $\gimel$  家庭背景。

### 变异系数法

变异系数法是一种常见的客观赋权法，其核心逻辑是用数据波动来确定权重。变异系数的计算很简单，就是用标准差除以平均值。变异系数越大，则数据的偏离程度越大。

变异系数法的思想中，某个指标偏离程度越大，说明该指标越难以实现，因此它是反映所评对象差距的关键指标，应被赋予更高的权重。

我们拿到了一份成绩单，如图 9- 7 所示，如何通过变异系数法来确定各科的权重呢？

图 9-7 成绩单样例  

<table><tr><td>学生编号</td><td>语文</td><td>数学</td><td>英语</td><td>体育</td></tr><tr><td>001</td><td>58</td><td>84</td><td>55</td><td>76</td></tr><tr><td>002</td><td>79</td><td>58</td><td>91</td><td>64</td></tr><tr><td>003</td><td>53</td><td>73</td><td>73</td><td>75</td></tr><tr><td>004</td><td>69</td><td>65</td><td>61</td><td>71</td></tr><tr><td>005</td><td>68</td><td>77</td><td>50</td><td>91</td></tr><tr><td>006</td><td>70</td><td>93</td><td>58</td><td>50</td></tr><tr><td>007</td><td>85</td><td>83</td><td>95</td><td>68</td></tr><tr><td>008</td><td>100</td><td>78</td><td>64</td><td>92</td></tr><tr><td>009</td><td>55</td><td>56</td><td>90</td><td>52</td></tr><tr><td>010</td><td>89</td><td>85</td><td>65</td><td>58</td></tr><tr><td colspan="5">...</td></tr></table>

先计算各科的平均数、标准差，然后用标准差除以平均数来计算出变异系数，即变异系数  $\equiv$  标准差/平均数，如图 9- 8 所示。

<table><tr><td>科目</td><td>平均数</td><td>标准差</td><td>变异系数</td></tr><tr><td>语文</td><td>75.78</td><td>13.63</td><td>0.18</td></tr><tr><td>数学</td><td>76.22</td><td>12.60</td><td>0.17</td></tr><tr><td>英语</td><td>72.44</td><td>15.46</td><td>0.21</td></tr><tr><td>体育</td><td>74.11</td><td>13.93</td><td>0.19</td></tr></table>

图 9-8 变异系数的计算

然后求各科变异系数值的占比，即权重，如图 9- 9 所示。例如，语文权重  $= 0.18/$ $(0.18 + 0.17 + 0.21 + 0.19) = 0.24$

<table><tr><td>科目</td><td>平均数</td><td>标准差</td><td>变异系数</td><td>权重</td></tr><tr><td>语文</td><td>75.78</td><td>13.63</td><td>0.18</td><td>24%</td></tr><tr><td>数学</td><td>76.22</td><td>12.60</td><td>0.17</td><td>22%</td></tr><tr><td>英语</td><td>72.44</td><td>15.46</td><td>0.21</td><td>29%</td></tr><tr><td>体育</td><td>74.11</td><td>13.93</td><td>0.19</td><td>25%</td></tr></table>

图 9-9 变异系数法的权重值计算

这样，我们通过变异系数法求得了各科的权重，也知道了英语成绩是这次拉开差异的主要科目。

除了上面介绍的几种权重确定方法，还有 AHP 层次分析法、熵权法、复相关系数法等诸多权重确定方法。受限于篇幅，这里不一一介绍，感兴趣的读者可以根据关键词查阅资料来进一步了解。

## 9.4 Pandas 权重计算和分析

回到本章最开始的那个需求：“有哪些细分类目发展比较好，将来可能有更多的机会呢？”

我们用 Pandas 来实现权重的计算和结果输出，最终用一个综合发展指数来量化细分类目的发展机会。

### 数据整合

整合数据之前，先确定要把哪些指标纳入赋权计算的范围。基于现有数据，到底哪些指标与行业发展机会更相关呢？

口销售额。销售额代表了行业的市场容量和规模，规模越大，说明市场蛋糕越大，这里我们取 2022 年和 2023 两年的销售额。

口销售增速。销售增速的大小直接对应着发展速度快慢，可以取 2023 年较 2022 年销售额的增速。

口客单价。客单价的高低和行业的利润空间、品牌溢价能力等密切相关。客单价是辅助量化指标，因此可以只取 2023 年的客单价数据。

至于访客数、转化率这两个和运营强相关的指标，可以暂时先放一放。

在 9.2 节中，合并聚合的结果 result 变量只有"销售额"字段。要计算我们所需的多个相关指标，需要先把所有的行业类目数据重新合并。这次我们采取直接遍历数据合并而不聚合的方式，代码如下：

```
result 2  $=$  pd. DataFrame（）
# 循环遍历表格名称

for name in os. listdir（):

df  $=$  pd. read_excel（name)

# 摄取年度标签

df['年份']  $=$  df['日期']. str[: 4]df['销售额']  $=$  df['访客数']\*df['转化率']\*df['客单价']result 2  $=$  pd.concat ([result 2, df])

# result 2
```

运行结果如下：

<table><tr><td></td><td>日期</td><td>品牌</td><td>访客数</td><td>转化率</td><td>客单价</td><td>三级类目</td><td>详细类目</td><td>年份</td><td>销售额</td></tr><tr><td>0</td><td>2023-12</td><td>品牌-14</td><td>9348</td><td>0.06</td><td>134</td><td>冰瓜</td><td>专用户外运动装备&amp; amp; 冰瓜</td><td>2023</td><td>76284.02</td></tr><tr><td>1</td><td>2023-12</td><td>品牌-20</td><td>1187</td><td>0.05</td><td>1244</td><td>冰瓜</td><td>专用户外运动装备&amp; amp; 冰瓜</td><td>2023</td><td>70864.93</td></tr><tr><td>2</td><td>2023-12</td><td>品牌-4</td><td>10432</td><td>0.05</td><td>97</td><td>冰瓜</td><td>专用户外运动装备&amp; amp; 冰瓜</td><td>2023</td><td>49795.12</td></tr><tr><td>3</td><td>2023-12</td><td>品牌-13</td><td>4648</td><td>0.02</td><td>428</td><td>冰瓜</td><td>专用户外运动装备&amp; amp; 冰瓜</td><td>2023</td><td>48722.98</td></tr><tr><td>4</td><td>2023-12</td><td>品牌-18</td><td>3977</td><td>0.06</td><td>71</td><td>冰瓜</td><td>专用户外运动装备&amp; amp; 冰瓜</td><td>2023</td><td>16167.85</td></tr><tr><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td></tr><tr><td>475</td><td>2022-01</td><td>品牌-15</td><td>17998</td><td>0.03</td><td>220</td><td>防潮垫</td><td>防潮垫-地墻-枕头&amp; amp; 防潮垫</td><td>2022</td><td>124890.09</td></tr><tr><td>476</td><td>2022-01</td><td>品牌-1</td><td>22670</td><td>0.01</td><td>615</td><td>防潮垫</td><td>防潮垫-地墻-枕头&amp; amp; 防潮垫</td><td>2022</td><td>108152.84</td></tr><tr><td>477</td><td>2022-01</td><td>品牌-11</td><td>41793</td><td>0.07</td><td>35</td><td>防潮垫</td><td>防潮垫-地墻-枕头&amp; amp; 防潮垫</td><td>2022</td><td>105467.83</td></tr><tr><td>478</td><td>2022-01</td><td>品牌-7</td><td>29124</td><td>0.04</td><td>96</td><td>防潮垫</td><td>防潮垫-地墻-枕头&amp; amp; 防潮垫</td><td>2022</td><td>102735.96</td></tr><tr><td>479</td><td>2022-01</td><td>品牌-8</td><td>13169</td><td>0.04</td><td>140</td><td>防潮垫</td><td>防潮垫-地墻-枕头&amp; amp; 防潮垫</td><td>2022</td><td>68046.68</td></tr><tr><td colspan="10">61440 rows × 9 columns</td></tr></table>

以上得到了所有细分类目数据的整合结果，一共 61440 行数据。

### 关键指标计算

#### 1. 销售额和销售增速

在 9.2 节中，我们已经计算出了每个细分类目 2022 年和 2023 年的销售额及增速，查看一下：

final.head ()

运行结果如下：

<table><tr><td></td><td>项目</td><td>2022 年销售额</td><td>2023 年销售额</td><td>销售增速</td><td>大类目</td><td>细分类目</td></tr><tr><td>0</td><td>专项户外运动装备&amp; amp; 冰爪</td><td>7884578.41</td><td>30163749.95</td><td>2.83</td><td>专项户外运动装备</td><td>冰爪</td></tr><tr><td>1</td><td>专项户外运动装备&amp; amp; 呼吸管-呼吸器</td><td>7173132.43</td><td>17198793.49</td><td>1.40</td><td>专项户外运动装备</td><td>呼吸管-呼吸器</td></tr><tr><td>2</td><td>专项户外运动装备&amp; amp; 安全带</td><td>19393866.43</td><td>66140160.84</td><td>2.41</td><td>专项户外运动装备</td><td>安全带</td></tr><tr><td>3</td><td>专项户外运动装备&amp; amp; 救生衣</td><td>23820417.15</td><td>98807893.65</td><td>3.15</td><td>专项户外运动装备</td><td>救生衣</td></tr><tr><td>4</td><td>专项户外运动装备&amp; amp; 气瓶</td><td>8052409.00</td><td>36317479.97</td><td>3.51</td><td>专项户外运动装备</td><td>气瓶</td></tr></table>

#### 2. 计算客单价

在整合的 result 2 里，有每一个细分类目是每月的客单价数据，但要计算整年的客单价，还要从客单价公式入手。

口客单价  $\coloneqq$  销售额/购买人数

口购买人数  $\coloneqq$  访客数  $\times$  转化率

所以，年度客单价  $\coloneqq$  年度销售额/年度购买人数。用 Pandas 来实现，代码如下：

计算每个月的购买人数 result 2['购买人数'] = result 2['访客数'] * result 2['转化率']# 每个类目，按年份汇总，计算对应的年度销售额、年度购买人数 item_gp = result 2.groupby (['详细类目', '年份']) [['销售额', '购买人数'\|'销售额', '购买人数']]. sum (). reset_index ()# 计算年度客单价 item_gp['客单价'] = item_gp['销售额'] / item_gp['购买人数']# 最终客单价，根据需求，只取 2023 年的 item_gp = item_gp. loc[item_gp['年份'] == '2023', :]item_gp.head ()

运行结果如下：

<table><tr><td></td><td>详细类目</td><td>年份</td><td>销售额</td><td>购买人数</td><td>客单价</td></tr><tr><td>1</td><td>专项户外运动装备&amp; amp; 冰爪</td><td>2023</td><td>30163749.95</td><td>310832.84</td><td>97.04</td></tr><tr><td>3</td><td>专项户外运动装备&amp; amp; 呼吸管-呼吸器</td><td>2023</td><td>17198793.49</td><td>136986.67</td><td>125.55</td></tr><tr><td>5</td><td>专项户外运动装备&amp; amp; 安全带</td><td>2023</td><td>66140160.84</td><td>303756.40</td><td>217.74</td></tr><tr><td>7</td><td>专项户外运动装备&amp; amp; 救生衣</td><td>2023</td><td>98807893.65</td><td>445640.13</td><td>221.72</td></tr><tr><td>9</td><td>专项户外运动装备&amp; amp; 气瓶</td><td>2023</td><td>36317479.97</td><td>33514.51</td><td>1083.63</td></tr></table>

我们拿到了每个细分类目的 2023 年客单价数据，下一步是将销售额、增速和客单价数据进行整合。用 merge（）方法将两者合并，进一步提取我们所需的字段。

final 表的类目和 item_gp 表的详细类目是一样的

```
final_new = pd.merge (final, item_gp, left_on = '类目', right_on = '详细类目', how = 'inner') #提取合并后的关键指标final_new = final_new['类目', '2022 年销售额', '2023 年销售额', '销售增速', '客单价']final_new.head ()
```

运行结果如下：

<table><tr><td></td><td>类目</td><td>2022 年销售额</td><td>2023 年销售额</td><td>销售增速</td><td>客单价</td></tr><tr><td>0</td><td>专项户外运动装备&amp; amp; 冰爪</td><td>7884578.41</td><td>30163749.95</td><td>2.83</td><td>97.04</td></tr><tr><td>1</td><td>专项户外运动装备&amp; amp; 呼吸器-呼吸器</td><td>7173132.43</td><td>17198793.49</td><td>1.40</td><td>125.55</td></tr><tr><td>2</td><td>专项户外运动装备&amp; amp; 安全带</td><td>19393866.43</td><td>66140160.84</td><td>2.41</td><td>217.74</td></tr><tr><td>3</td><td>专项户外运动装备&amp; amp; 救生衣</td><td>23820417.15</td><td>98807893.65</td><td>3.15</td><td>221.72</td></tr><tr><td>4</td><td>专项户外运动装备&amp; amp; 气瓶</td><td>8052409.00</td><td>36317479.97</td><td>3.51</td><td>1083.63</td></tr></table>

### 权重的计算

#### 1. 变异系数法

根据变异系数法，我们需要计算每个指标的平均值和标准差。利用 describe（）方法可以直接计算出相关指标：

final_new.describe ()

运行结果如下：  

<table><tr><td></td><td>2022 年销售额</td><td>2023 年销售额</td><td>销售增速</td><td>客单价</td></tr><tr><td>count</td><td>128.00</td><td>128.00</td><td>128.00</td><td>128.00</td></tr><tr><td>mean</td><td>105009765.18</td><td>389253544.32</td><td>2.79</td><td>245.77</td></tr><tr><td>std</td><td>231216148.93</td><td>863806475.71</td><td>0.61</td><td>251.62</td></tr><tr><td>min</td><td>589492.92</td><td>2094447.84</td><td>1.40</td><td>18.37</td></tr><tr><td>25%</td><td>8931205.15</td><td>32890176.12</td><td>2.40</td><td>77.96</td></tr><tr><td>50%</td><td>27727218.81</td><td>113122708.51</td><td>2.80</td><td>153.08</td></tr><tr><td>75%</td><td>90346726.97</td><td>371512115.05</td><td>3.20</td><td>321.37</td></tr><tr><td>max</td><td>1535788007.33</td><td>6578928834.59</td><td>4.35</td><td>1615.38</td></tr></table>

基本统计指标都已经计算好了，这里只需要提取平均值和标准差，所以把数据转置，然后提取 mean 和 std 列：

`cov = final_new.describe (). T [['mean', 'std']]. print (cov)`

运行结果如下：

<table><tr><td></td><td>mean</td><td>std</td></tr><tr><td>2022 年销售额</td><td>105009765.18</td><td>231216148.93</td></tr><tr><td>2023 年销售额</td><td>389253544.32</td><td>863806475.71</td></tr><tr><td>销售增速</td><td>2.79</td><td>0.61</td></tr><tr><td>客单价</td><td>245.77</td><td>251.62</td></tr></table>

再补充变异系数列，并根据变异系数的大小求出权重：

计算每个指标的变异系数 ```

```
cov['cov'] = cov['std'] / cov['mean']# 根据变异系数占比得到实际权重 cov['cov_pct'] = cov['cov'] / cov['cov']. sum () cov
```

运行结果如下：

<table><tr><td></td><td>mean</td><td>std</td><td>cov</td><td>cov_pct</td></tr><tr><td>2022</td><td>105009765.18</td><td>231216148.93</td><td>2.20</td><td>0.39</td></tr><tr><td>2023</td><td>389253544.32</td><td>863806475.71</td><td>2.22</td><td>0.39</td></tr><tr><td>销售增速</td><td>2.79</td><td>0.61</td><td>0.22</td><td>0.04</td></tr><tr><td>客单价</td><td>245.77</td><td>251.62</td><td>1.02</td><td>0.18</td></tr></table>

基于变异系数法，求得 2022 年和 2023 年销售额权重都是 0.39，销售增速权重是 0.04，2023 年客单价权重则是 0.18。

大家想一想，如果这样的权重值最终被采用，站在业务人员的角度看，会不会有问题？

尽管你告诉业务人员这是通过相对科学的客观赋权法得到的值，但大概率他还是会有以下质疑。

口 2023 年和 2022 年销售额的权重为什么一样？越近的年份销售额对我们来说参考价值越大才对。

口销售增速权重太低，要知道增速是一个直接反映趋势的指标。

口客单价作为一个辅助性的判断指标，权重竟然远高于销售增速，不符合业务逻辑。

所以，接下来我们尝试用权值因子判表法做一个对比。

#### 2. 权值因子判表法

制定好了打分表，并找需求相关部门的 5 个重要角色打分，最终拿到了 5 位专家的打分表。我们用 Pandas 读取，代码如下：

```
data = pd. read_excel ('专家打分表. xlsx') data.head (8)
```

结果如图 9- 10 所示。

<table><tr><td>专家编号</td><td>关键指标</td><td>2022 年销售额</td><td>2023 年销售额</td><td>销售增速</td><td>客单价</td></tr><tr><td>0</td><td>1</td><td>2022 年销售额</td><td>NaN</td><td>0.00</td><td>0.00</td></tr><tr><td>1</td><td>1</td><td>2023 年销售额</td><td>1.00</td><td>NaN</td><td>NaN</td></tr><tr><td>2</td><td>1</td><td>销售增速</td><td>1.00</td><td>1.00</td><td>NaN</td></tr><tr><td>3</td><td>1</td><td>客单价</td><td>0.00</td><td>0.00</td><td>NaN</td></tr><tr><td>4</td><td>2</td><td>2022 年销售额</td><td>NaN</td><td>0.00</td><td>0.00</td></tr><tr><td>5</td><td>2</td><td>2023 年销售额</td><td>1.00</td><td>NaN</td><td>0.00</td></tr><tr><td>6</td><td>2</td><td>销售增速</td><td>1.00</td><td>1.00</td><td>NaN</td></tr><tr><td>7</td><td>2</td><td>客单价</td><td>1.00</td><td>0.00</td><td>NaN</td></tr></table>

要计算 5 位专家给每个维度的打分，先横向汇总每一行的得分情况，再分别按照 4 个指标分组求平均即可。

把空缺值用 0 填充，否则汇总值也会是 

```
NaNdata.fillna (0, inplace = True)# 计算每一行的汇总值 data['分值汇总'] = data['2022 年销售额'] + data['2023 年销售额'] + data['销售增速'] + data['客单价']# 按照 2022 年销售额、2023 年销售额、增速、客单价四个指标分组，并统计汇总分值的平均分 data_gp = data.groupby ('关键指标')['分值汇总']. mean (). reset_index () print (data_gp) 
```


运行结果如下：

关键指标分值汇总 0 2022 年销售额 0.801 2023 年销售额 2.202 客单价 0.203 销售增速 2.80

再根据分值汇总结果计算各自的占比，得到最终权重。

这里的权重即分值汇总数值的占比 data_gp['权重'] = data_gp['分值汇总'] / data_gp['分值汇总']. sum () print (data_gp) 运行结果如下：

运行结果如下：

关键指标分值汇总权重 0 2022 年销售额 0.80 0.131 2023 年销售额 2.20 0.372 客单价 0.20 0.033 销售增速 2.80 0.47

综合 5 位专家的意见，对于行业发展趋势来说，4 个指标的重要度排序是销售增速  $>2023$  年销售额  $>2022$  年销售额  $>$  客单价。

这个结果值更符合业务逻辑，我们用权值因子判表法的权重结果进行后续计算。

### 数据标准化

各指标的权重已定，一般来说，只需要用各自的数值乘以权重，最终加总即可。但是，我们拿到的行业数据存在很严重的数据量级差异，销售额是千万元级别，而销售增速最多也只是个位数，客单价则是几百到几千元。量级差异过大，会导致权重没有任何意义。因此，我们需要先将数据标准化和去量纲。

这里我们介绍一种常用的最大最小值归一化法，它的计算公式为（对应列某个值- 列最小值）/（列最大值- 列最小值）。该公式把对应列所有的值都压缩在  $0\sim 1$  的范围内，让数据单位保持一致。

用 Pandas 来实现，代码如下：

每一个指标都套用了上面的法量纲公式

```
final_new['2022_mms']  $=$  （final_new['2022 年销售额']- final_new['2022 年销售额']min（）/（final_new['2022 年销售额']- max（)- final_new['2022 年销售额']- min（））final_new['2023_mms']  $=$  （final_new['2023 年销售额']- final_new['2023 年销售额']- min（））min（）/（final_new['2023 年销售额']- max（)- final_new['2023 年销售额']- min（））final_new['销售增速_mms']  $=$  （final_new['销售增速']- final_new['销售增速']- min（））（final_new['销售增速']- max（)- final_new['销售增速']- min（））final_new['客单价_mms']  $=$  （final_new['客单价']- final_new['客单价']- min（））/（final_new['客单价']- max（)- final_new['客单价']- min（））接 2023 年销售额排序，查看值与条结果 final_new. sort_values（'2023 年销售额', ascending  $=$  False). head（）
```

运行结果如图 9- 11 所示

可以看到，目前所有关键指标的量纲都得到了统一。

<table><tr><td></td><td>类目</td><td>2022 年销售额</td><td>2023 年销售额</td><td>销售增速</td><td>客单价</td><td>2022_mms</td><td>2023_mms</td><td>销售增速
_mms</td><td>客单价
_mms</td></tr><tr><td>67</td><td>户外服装&amp; amp; 户外服装</td><td>1535788007.33</td><td>6578928834.59</td><td>3.28</td><td>405.94</td><td>1.00</td><td>1.00</td><td>0.64</td><td>0.24</td></tr><tr><td>17</td><td>垂钓装备&amp; amp; 垂钓装备</td><td>1263322207.67</td><td>4530217246.31</td><td>2.59</td><td>107.43</td><td>0.82</td><td>0.69</td><td>0.40</td><td>0.06</td></tr><tr><td>95</td><td>户外鞋靴&amp; amp; 户外鞋靴</td><td>1174675113.88</td><td>3554767358.42</td><td>2.03</td><td>423.33</td><td>0.76</td><td>0.54</td><td>0.21</td><td>0.25</td></tr><tr><td>31</td><td>垂钓装备&amp; amp; 钓竿</td><td>666732975.43</td><td>3053970690.23</td><td>3.58</td><td>293.47</td><td>0.43</td><td>0.46</td><td>0.74</td><td>0.17</td></tr><tr><td>58</td><td>户外服装&amp; amp; 冲锋衣</td><td>913619579.64</td><td>2826169162.98</td><td>2.09</td><td>557.40</td><td>0.59</td><td>0.43</td><td>0.24</td><td>0.34</td></tr></table>

### 综合发展指数

要计算综合发展指数，只需要把对应的数值乘以权重并加总即可。

每个归一化后的值乘以之前计算的对应权重 

```
final_new['综合发展指数'] = final_new['2022_mms'] * 0.13 + final_new['2023_mms'] * 0.37 + final_new['销售增速_mms'] * 0.47 + final_new['签单价_mms'] * 0.03 按综合指数排序查看前 10 的细分类目，为了简化展示，只提取了几个关键字段，没有取归一化的结果 final_new. sort_values ('综合发展指数', ascending = False) ['类目', '2022 年销售额', '2023 年销售额', '销售增速', '签单价', '综合发展指数'] hadd (10)
```

代码执行结果如图 9- 12 所示

<table><tr><td></td><td>类目 2022 年销售额</td><td>2023 年销售额</td><td>销售增速</td><td>客单价</td><td>综合发展指数</td><td></td></tr><tr><td>67</td><td>户外服装 &amp; amp; 户外服装</td><td>1535788007.33</td><td>6578928834.59</td><td>3.28</td><td>405.94</td><td>0.81</td></tr><tr><td>31</td><td>垂钓装备 &amp; amp; 钓竿</td><td>666732975.43</td><td>3053970690.23</td><td>3.58</td><td>293.47</td><td>0.58</td></tr><tr><td>17</td><td>垂钓装备 &amp; amp; 垂钓装备</td><td>1263322207.67</td><td>4530217246.31</td><td>2.59</td><td>107.43</td><td>0.55</td></tr><tr><td>45</td><td>垂钓装备 &amp; amp; 鱼钩</td><td>55895341.31</td><td>299165733.63</td><td>4.35</td><td>42.54</td><td>0.49</td></tr><tr><td>122</td><td>防护-救生装备 &amp; amp; 防护-救生装备</td><td>103906995.09</td><td>516112688.85</td><td>3.97</td><td>88.71</td><td>0.45</td></tr><tr><td>42</td><td>垂钓装备 &amp; amp; 鱼线</td><td>103102216.89</td><td>512039937.97</td><td>3.97</td><td>50.67</td><td>0.45</td></tr><tr><td>111</td><td>望远镜-夜视仪-户外眼镜 &amp; amp; 望远镜-夜视仪-户外眼镜</td><td>220271388.35</td><td>1025433112.52</td><td>3.66</td><td>357.62</td><td>0.44</td></tr><tr><td>43</td><td>垂钓装备 &amp; amp; 鱼线轮</td><td>205590742.05</td><td>955452386.15</td><td>3.65</td><td>434.42</td><td>0.44</td></tr><tr><td>26</td><td>垂钓装备 &amp; amp; 浮漂</td><td>104103534.51</td><td>502844205.49</td><td>3.83</td><td>69.13</td><td>0.42</td></tr><tr><td>74</td><td>户外服装 &amp; amp; 羽绒衣</td><td>512927562.77</td><td>1994130010.74</td><td>2.89</td><td>1615.38</td><td>0.42</td></tr></table>

图 9-12 权重结果

由上面的结果不难发现，户外运动行业具有以下发展特点。

无服装，不户外。一旦大家想户外，首先要解决的是服装问题。户外服装凭借高销售规模、高增长成为最具潜力的细分类目。

钓鱼是户外运动的王者。发展趋势前 10 的细分类目，有 6 个是与垂钓装备相关的，这个行业需要重点关注。

## 9.5 本章小结

权重的确定方法有很多，如级别法、权值因子判表法、变异系数法等，既有主观赋权法，也有客观赋权法。

在确定各指标的权重之后，综合指标的计算一定要考虑量纲的差异，如果量级差异过大，需要先去量纲再汇总计算。

最后，我想强调和补充的是，在实际工作中，权重与综合指数的应用效果，除了计算方法的科学性，还有两个非常重要的特性一定要注意。

口业务可理解性。如果是复杂的权重计算模型，一定要用简要的话来提炼，最好做到一句话让业务人员明白。因为他们的理解程度会影响最终策略和建议能否落地。

口是否符合业务逻辑。正如上面的案例所示，用客观赋权的变异系数法最终得到的权重可能符合数据规律，但和实际业务或者商业逻辑相悖，很容易受到抵触。权重的计算只有和业务逻辑相契合，才能顺利推动。毕竟，能推动业务的分析，才是好的分析。
