---
{"dg-publish":true,"dg-permalink":"books/27055712/09","permalink":"/books/27055712/09/","metatags":{"description":"","og:site_name":"DavonOs","og:title":"第9章 通过应用程序连接数据库","og:type":"article","og:url":"https://zuji.eu.org/books/27055712/09","og:image":"https://file.ituring.com.cn/LargeCover/1712477631b07b9f5895","og:image:width":"200","og:image:alt":"articlecover","og:locale":"zh_cn"},"dgShowInlineTitle":true,"created":"2025-09-10 14:55","updated":"2025-09-11 08:25"}
---


# 本章重点

截止到第 8 章，关于使用 SQL 语句处理数据的基础知识的学习就告一段落了。本章将会转换一下视角，带领大家了解如何通过应用程序执行 SQL 语句来处理数据。

本章将使用 Java 语言来编写应用程序连接数据库。Java 是现在非常流行的应用程序开发语言。为了执行 Java 程序，大家需要在自己的电脑中安装 Java 开发工具 JDK（Java Development Kit）。JDK 可以从 Oracle 公司的网站下载，下载和安装步骤请参考“JDK 下载安装手册”文件，该文件可以从以下网站下载。

http://www.ituring.com.cn/book/1880

此外，本章假定大家已经按照第 0 章的步骤完成了 PostgreSQL 的安装。没有安装 PostgreSQL 的读者，请按照第 0 章的步骤提前安装好 PostgreSQL。



# 第 9 章通过应用程序连接数据库

# 数据库世界和应用程序世界的连接

# 学习重点

- 在实际的系统中是通过应用程序向数据库发送 SQL 语句的。- 此时，需要通过“驱动”这座桥梁来连接应用程序世界和数据库世界。如果没有驱动，应用程序就无法连接数据库。- 数据库和编程语言之间的驱动有很多种，如果不注意的话就会发生驱动不匹配的情况。

# 数据库和应用程序之间的关系

无论大家是搭建自己的网站，还是从事系统开发工作，都无法只通过数据库来实现。数据库作为保存数据的重要手段，在系统开发中是不可或缺的，但这并不意味着它可以覆盖系统开发所需的所有功能。在画面上呈现炫酷的动画、根据查询结果数据变换用户界面等复杂的处理（业务逻辑）单靠数据库和 SQL 语句是无法实现的。

# KEYWORD

应用程序（应用、App）

# 注 1

iPhone、iPad 的应用程序下载服务称为“应用商店”（AppStore），这里的“App”就是来源于苹果公司的名称“Apple”和应用程序“Application”这两个词吧。

这时就需要通过一些应用程序和数据库的组合来搭建系统了。这些应用程序可以使用各种各样的编程语言来编写，代表性的语言有 Java、C#、Python 和 Perl 等。就连 C 语言和 COBOL 这些很早就有的语言，目前仍在某些领域发挥着作用。使用这些语言编写的程序就称为应用程序，简称为应用或者 App。想必大家在自己的电脑和智能手机中都安装过很多应用程序吧？

简而言之，系统其实就是由应用和数据库组合而成的，如图 9- 1 所示。

![](https://cdn-mineru.openxlab.org.cn/result/2025-09-10/73f80d02-cbfb-4685-880f-8c0771d72bfe/c381b62b50897cb917c7dc366436b345343fae1d2365124da04f6070a69a9a0f.jpg)  
图 9-1 系统就是应用和数据库的组合

当然，这仅仅是一个极简的模型而已，实际的系统其实是由许许多多的组件构成的（例如：防止外部攻击的防火墙、接收 Web 浏览器发送的请求的 Web 服务器等）。但不管怎样，只要理解了系统主要的构成元素是应用和数据库两部分就足够了。

# 驱动——两个世界之间的桥梁

应用和数据库组合使用时会产生一个很大的问题。因为应用是由各种各样的语言编写的，所以语法和功能都不尽相同。数据库也是如此，不同的 DBMS 的功能和 SQL 语法也有很大区别（正如我们在第 1 章介绍的那样，光是具有代表性的 DBMS 就有 5 种之多）。因此，在应用和数据库之间发送 SQL 语句和接收结果数据的方法也就变得五花八门了。一旦编程语言或者 DBMS 发生变化，就不得不从头开始修改应用和 SQL 语句，而这种情况是大家都不愿看到的。

# KEYWORD

# ●驱动

# 注①

说到“driver”这个词，大家可能会一下子想到螺丝刀。英语中这两者确实是同一个单词。实际上，螺丝刀也是用来把两个部件连接在一起的，从广义上来说也能叫桥梁。在计算机的世界里，那些用来将打印机、键盘和鼠标等连接到电脑上的程序也被称为“驱动”，它同样肩负着“连接不同机器”的使命。

解决这个问题的方法就是在两个世界之间导入一个称为驱动（driver）的中介程序。驱动就是一个用来连接应用和数据库的非常小的特殊程序（大概只有几百 KB）。在两者之间插入驱动程序之后，应用方面就可以只针对应用进行特别处理，数据库方面也可以只针对数据库进行特别处理了。不管哪一方发生版本升级或产品变更，都只需要对驱动的连接部分进行很小的修改就可以了。

换言之，驱动就是应用和数据库这两个世界之间的桥梁（图 9- 2）。

![](https://cdn-mineru.openxlab.org.cn/result/2025-09-10/73f80d02-cbfb-4685-880f-8c0771d72bfe/904132b75c0657ddcf2dfc7011f228be9bf12285f098929c83115dad9aa93447.jpg)  
图 9-2 驱动就是应用和数据库之间的桥梁

# 驱动的种类

虽说驱动只是一个很小的程序，但它也是通过某种编程语言编写而成的。不过，大家并不需要特意去编写驱动程序，通常情况下 DBMS 都会提供相应的驱动程序。需要注意的是，根据 DBMS 和编程语言的不同，使用的驱动程序也不一样。说得再细一点，即便是相同的 DBMS，其 32 位版本和 64 位版本的驱动也是不一样的（PostgreSQL 的 JDBC 驱动涵盖了这两个版本的不同，因此在本次学习过程中大家可以不必考虑这种差异）。如果使用了错误的驱动，就会导致 SQL 语句无法发送，甚至数据库无法连接，请大家务必注意。

# KEYWORD

- ODBC- JDBC

现在广泛使用的驱动标准主要有 ODBC（Open DataBase Connectivity）和 JDBC（Java DataBase Connectivity）两种。ODBC 是 1992 年微软公司发布的 DBMS 连接标准，后来逐步成为了业界标准。JDBC 是在此基础上制定出来的 Java 应用连接标准。本书也将使用 PostgreSQL 的 JDBC 驱动来实现 Java 应用和数据库之间的连接。

PostgreSQL 的 JDBC 驱动可以从如下网站下载。不同的 PostgreSQL 版本需要使用不同的驱动，请大家选择适当的版本下载。

- PostgreSQL JDBC Driver https://jdbc.postgresql.org/download.html

# 注 1

JDBC 的版本是不断更新的，请大家下载当前的最新版本。

本书使用 Java Version 8 作为执行环境，因此需要点击相应的最新版本“9.4.1208 JDBC 42”的链接来下载。下载后会得到如下文件。

postgresql- 9.4.1208. jar

这就是驱动程序了，它的文件名会根据版本的不同而变化。“. jar”这个扩展名看上去比较陌生，它是 Java 可执行文件的扩展名（后面将要介绍的类文件的集合体）。

该文件可以保存在电脑的任意文件夹下，不过为了便于之后操作，文件夹的名称最好比较短，仅由几个英文字母组成，因此我们在第 0 章安装 PostgreSQL 时创建的“C:\PostgreSQL”文件夹下面创建一个名为“jdbc”的文件夹，用来保存下载的驱动文件（图 9- 3）。注意文件夹名只能使用“半角英文字母和数字”，如果使用全角字符的话，将会无法正常运行。

C:\PostgreSQL\jdbc

![](https://cdn-mineru.openxlab.org.cn/result/2025-09-10/73f80d02-cbfb-4685-880f-8c0771d72bfe/a5a68a1122088328a830a6330eca9c231fde2e17dda8c2b2104b075c7c13ca7e.jpg)  
图 9-3 将驱动文件保存在电脑的文件夹下

至此，通过程序连接数据库的准备工作就完成了。接下来就让我们使用 Java 程序来实际连接一下 PostgreSQL 数据库吧。为了实现该操作，首先需要了解一下 Java 基本的编程方法和执行方法。

# 9-2

# 第 9 章通过应用程序连接数据库

# Java 基础知识

# 学习重点

- 执行 Java 程序时，必须先对源代码进行编译。- 与 SQL 语句不同，Java 源代码的保留字是区分大小写的。

本章使用的编程语言是 Java。由于本书并不是 Java 语言的入门，因此我们不会深入学习 Java 的语法和句法，但由于我们要编写一个用来连接数据库的小程序，因此这里会简单介绍一些必要的知识。如果大家已经对 Java 有了一定程度的了解，那么可以略过本小节。

# 第一个程序 Hello, World

# KEYWORD

# 编程

编写程序的源代码。

首先我们用 Java 编写一个简单的示例程序并实际执行一下。这个程序并不会连接数据库，程序的内容也非常简单，就是“在画面上显示简短的字符串”。输出的字符串是“Hello, World”，直译过来就是“你好，世界”。这个字符串并没有什么特别的意义，只不过编程界从几十年前就有一个传统，把 Hello, World 作为“最初开始编程时输出的字符串”。

# 编写源代码，保存为源文件

# KEYWORD

# 源代码

应用程序原始的字符串，也就是编写出来的程序，也简称为代码。

由于要实现的功能非常简单，因此 Java 的源代码也非常简单。

# 代码清单 9-1 在画面上显示简短字符串的 Java 程序

public class Hello{ public static void main (String[] args){ System.out.print ("Hello, World"); 1 1

首先，我们使用记事本等文本编辑器把上述示例代码保存到名为“Hello. java”的文件中，然后将该文件保存在如下文件夹。

# C:\PostgreSQL\java\src

“src”是“源代码”（source）的简称，经常用来作为保存源代码的文件夹名称。该文件夹的位置并没有特殊要求，但为了便于理解，我们把它放在 PostgreSQL 文件夹下面（图 9- 4）。

![](https://cdn-mineru.openxlab.org.cn/result/2025-09-10/73f80d02-cbfb-4685-880f-8c0771d72bfe/9cca90bef6abf49a3a10c6b7fce5822328d21338a05142a3ca01c1c9b3e1b987.jpg)  
图 9-4 把源代码文件保存在文件夹之中

# 注 1

其实正确的说法应该是“方法”，不过现在大家还不用在意函数和方法的区别。

# 注 2

想详细了解的读者可以参考其他 Java 的入门书。

源代码第 3 行的“Hello, World”就是我们希望显示的字符串。如果想显示其他字符串，只需要换掉该字符串即可。请大家注意，SQL 语句中的字符串是使用单引号（'）括起来的，而在 Java 中则需要使用双引号（"）括起来（请参考法则 1- 7）。同在第 3 行的 System. out. print 就是在画面上显示字符串的函数。

此外，“public class Hello”以及“public static void main (String[] args)”这些像咒语一样的字符串，现在也不用太在意。源代码的主要部分就是第 3 行，这一行发出了“在画面上显示字符串”的命令。

# 编译和程序执行

# KEYWORD

# 编译

# 注①

当然也有像 Python、PHP 这样在执行之前不需要显式地进行编译的编程语言。不过，它们的操作过程其实是一样的，执行时会（隐式地）进行编译。

把源文件保存到文件夹之后，Java 源代码的编写就完成了，但此时程序并不能执行，还需要编译（compile）这个步骤。编译本来是“编辑”的意思，但是在编程的世界里，它是“将人类书写的源代码转换为机器可以执行的代码”的意思。

前面我们执行 SQL 语句时并不需要进行编译，其实那是因为数据库内部自动进行了编译操作。使用 Java 或者 C 等编程语言编写的程序，在执行之前需要显式地进行编译操作。

代码的编译是通过已经安装的 JDK 自带的“javac. exe”程序进行的，程序名末尾的“c”是 compile 的缩写。该程序存放在“C:\PostgreSQL\java\jdk\bin”文件夹下，大家可以自行确认一下（图 9- 5）。

![](https://cdn-mineru.openxlab.org.cn/result/2025-09-10/73f80d02-cbfb-4685-880f-8c0771d72bfe/3b48f0347d871b90f9139a3db06cb0c04324681171a92d03bad13e9db8efa053.jpg)  
图 9-5 编译时使用的 javac. exe 程序

# 注②

如果使用的是 Window B/8.1，可以按照如下步骤启动命令提示符。1. 在电脑的开始画面，同时点击键盘上的"Windows"键和"X"键。2. 在画面左下角显示的菜单一览中点击“命令提示符（管理员）”。

javac. exe 需要通过命令提示符来执行。要启动命令提示符，需要使用鼠标右键点击电脑桌面左下角的 Windows 图标，在弹出的菜单中选择“命令提示符（管理员）（A）”。命令提示符启动后会弹出如图 9- 6 所示的窗口。

![](https://cdn-mineru.openxlab.org.cn/result/2025-09-10/73f80d02-cbfb-4685-880f-8c0771d72bfe/b47c877f4a467755cf0e794706670b935bdfc75c5714553983b0df5fb2c26c36.jpg)  
图 9-6 命令提示符窗口

# 注①

cd 是从“changedirectory”的缩写演化而来的命令。directory（目录）的意思跟文件夹相同，是 UNIX /Linux 的 OS 常用语。

首先，为了移动到源文件所在的文件夹，需要输入如下命令。输入之后，按下回车键。

# cd 命令（移动到指定文件夹）

cd C:\PostgreSQL\java\src

命令执行成功之后并不会显示什么特别的信息（图 9- 7）。执行失败时会显示错误信息，这时请确认命令或者文件夹名称字符串是否拼写正确。此外，请务必在 cd 后面添加一个半角空格。在命令提示符中使用的字符串必须全都是半角字符，如果使用全角字符的话可能会发生错误，因此请勿使用。

![](https://cdn-mineru.openxlab.org.cn/result/2025-09-10/73f80d02-cbfb-4685-880f-8c0771d72bfe/041793ee3f7534145925c076b8701063f9408de496d3016cbe09561295fb400c.jpg)  
图 9-7 cd C:\PostgreSQL\java\src 的执行结果

# 注②

像“C:\PostgreSQL\java\jdk\bin\javac”这样输入全部的文件夹名是非常麻烦的。其实省略掉文件夹这部分，直接输入“javac”也是可以的（需要设置环境变量 PATH）。具体的设置方法，可以参考相关的 Java 入门书。

# 使用 javac 命令进行编译，生成类文件

移动到相应的文件夹之后，在命令提示符中输入如下字符串，按下回车键。

# javac 命令（编译）

C:\PostgreSQL\java\jdk\bin\javac Hello. java

稍微等待一会儿，编译就结束了。如果编译成功，就不会显示任何信

息（图 9- 8）。只有发生了某些错误导致编译失败，才会显示错误信息。

![](https://cdn-mineru.openxlab.org.cn/result/2025-09-10/73f80d02-cbfb-4685-880f-8c0771d72bfe/50f7c3277b51930ab9beba84afba5e61f45e640bf08bbfce8bf76d16dd974721.jpg)  
图 9-8 C:\PostgreSQL\java\jdk\bin\javac Hello. java 的执行结果

# 法则 9-1

执行 Java 程序之前，必须对源代码进行编译。

编译成功之后，在存放源文件的文件夹下会生成一个名为“Hello. class”的新文件（图 9- 9）。这是一个可以执行的文件，称为“类文件”。

![](https://cdn-mineru.openxlab.org.cn/result/2025-09-10/73f80d02-cbfb-4685-880f-8c0771d72bfe/290470cb2e60d12a355dcaa5b80996fff97dea705a9f48671440385bfbd9e461.jpg)  
图 9-9 编译成功后会生成类文件

# 使用 java 命令执行程序

生成类文件之后，就可以执行程序了。执行程序时需要使用“C:\

PostgreSQL\java\jdk\bin”文件夹下的“java. exe”程序。在命令提示符中输入如下字符串，然后按下回车键。“Hello”是类名，与文件名中扩展名之前的字符串相同。

# java 命令（执行）

C:\PostgreSQL\java\jdk\bin\java Hello

如果命令提示符中显示出了“Hello, World”，就表示执行成功了（图 9- 10）。

![](https://cdn-mineru.openxlab.org.cn/result/2025-09-10/73f80d02-cbfb-4685-880f-8c0771d72bfe/6b4fa7758be67fa5e223790fbcc8345e8d1062cbdda89d447b1e2fd751298fde.jpg)  
图 9-10 cd C:\PostgreSQL\java\jdk\bin\java Hello 的执行结果

使用 Java 语言进行编程时，必须经过如下 3 个步骤，请大家务必牢记。

1. 编写源代码，保存为源文件

#

2. 使用 javac 命令进行编译，生成类文件

#

3. 使用 java 命令执行程序

# 常见错误

下面我们来介绍一下 Java 编程和执行时初学者经常犯的一些错误。

# 大小写错误

SQL 语句中的保留字是不区分大小写的，不论写成“SELECT 1;”还是“select 1;”，都能够正常执行，但是 Java 却是区分大小写的。

例如，在画面上显示字符串时使用的函数“System. out. print”，如果全部改成小写，如代码清单 9- 2 那样，结果会如何呢？

# 代码清单 9-2 “常见错误示例”大小写错误

public class Hello{ public static void main (String[] args){ system. out. print（"Hello, World"); 1 1

使用 javac 命令编译上述源文件，会发生如下错误。

# 执行结果

执行结果 Hello. java:3：错误：程序包 system 不存在  system.out.print ("Hello, World");

原因在于“Hello. java”文件的第 3 行出错了，把“System”写成了小写的“system”。

# 法则 9-2

Java 源代码中的保留字要区分大小写，这是它和数据库的不同点之一。

# 使用全角空格

如前所述，源代码中是不能使用全角字符的，SQL 语句中也一样。虽然没有人会把英文字母和数字都写成全角，不过偶尔还是会出现把半角空格写成全角空格的情况。

例如，我们把代码清单 9- 3 第 2 行开头的空格改成全角。

# 代码清单 9-3 “常见错误示例”使用全角空格

![](https://cdn-mineru.openxlab.org.cn/result/2025-09-10/73f80d02-cbfb-4685-880f-8c0771d72bfe/644eaff9f66ab1c13a2744f3a75a1b48c00c19eca60e32624e6d5caac9b877eb.jpg)

使用 javac 命令编译上述源文件，会发生如下错误。

# 执行结果

执行结果 Hello. java:2：错误：非法字符：'\u 3000'  public static void main (String[] args){

原因在于“Hello. java”文件的第 2 行出错了，“\u 3000”是表

示全角空格的字符代码，也就是说，我们“使用了不应该使用的字符”。

# 法则 9-3

Java 源代码中不能出现全角字符／全角空格（注释除外）。

# 源文件的文件名和类名不一致

例如，让我们把之前创建的源文件“Hello. java”的文件名改成“Test. java”并进行编译。命令如下所示。

# 编译

C:\PostgreSQL\java\jdk\bin\javac Test. java

结果就会发生如下错误。

# 执行结果

Test. java：1：错误：类 Hello 是公共的，应在名为 Hello. java 的文件中声明 public class Hello{

这是由于源文件中创建的类的名称“Hello”与文件名“Test”不一致，文件名必须和源代码第 1 行的类名一致。大家需要注意的是，这里的一致也包括大小写一致。

# 命令名和文件名错误

编译或者执行时，如果输入了错误的命令名或者文件名，结果当然会发生错误。尤其要注意不要把 javac 和 java 命令的文件夹名写错了。

例如，像下面这样把文件夹名“bin”错写成“vin”，执行就会出错。

# 执行（文件夹名错误）

C:\PostgreSQL\java\jdk\vin\java Hello

# 执行结果

系统找不到指定的路径。

原因就在于找不到指定的文件夹。如果把类名“Hello”错写成“Hallo”，也会出错。

# 执行（类名错误）

C:\PostgreSQL\java\jdk\bin\java Hallo

# 执行结果

错误：找不到或无法加载主类 Hallo。

这也是因为找不到指定的类而导致的。

其实，为了减少类似的输入错误，可以设置成省略指定文件夹名这一步，不过本书中并不需要反复执行这些命令，因此省略了该设置。直接使用复制粘贴的话，不用每次都输入，也不算太辛苦吧。

# 专栏

# 在命令提示符中的粘贴方法

在 Windows 10 中，可以在命令提示符画面中使用“Ctrl”快捷键。因此，可以使用“Ctrl”+“C”键复制文本文件中的字符串，然后在命令提示符画面中使用“Ctrl”+“V”键进行粘贴。

记住此方法之后，就不需要输入很长的字符串了，十分方便。

# Windows 8/8.1 之前的版本

要想把复制的字符串粘贴到命令提示符画面中，需要使用鼠标右键点击命令提示符的标题栏，在弹出的菜单中选择“编辑（E）”→“粘贴（P）”（图 A）。

# 注 1

如果 Windows 10 的命令提示符画面中无法使用“Ctrl”+“V”键，请按照如下步骤启用 Ctrl 快捷键。1. 鼠标右键点击命令提示符窗口，在弹出的菜单中选择“属性”，进入命令提示符的属性画面。2. 在属性画面的“选项”标签下的编辑选项中选择“启用 Ctrl 快捷键”。

# 图 A 将字符串粘贴到命令提示符画面中

![](https://cdn-mineru.openxlab.org.cn/result/2025-09-10/73f80d02-cbfb-4685-880f-8c0771d72bfe/eba09e8c588c5132b1aae658146d56973cfaf7f3eb39b7164777156a8dc32552.jpg)

要想在命令提示符中进行复制，需要选择“编辑（E）”→“范围指定（K）”，然后拖动鼠标选定想要复制的范围，再选择“编辑（E）”→“复制（C）”。

经常需要接触命令提示符的读者，如果记住了这些操作，就不用每次都输入冗长的命令名了。

# 9-3

# 第 9 章通过应用程序连接数据库

# 通过 Java 连接 PostgreSQL

# 学习重点

·可以使用 Java 程序，通过驱动来执行各种各样的 SQL 语句。

·通过数据库将 SELECT 语句的结果传递给 Java 程序之后，只能逐条循环访问。这就是可以同时操作多条数据的数据库世界和每次只能操作一条数据的程序世界的区别。

# 执行 SQL 语句的 Java 程序

前面我们已经了解了 Java 程序的编译和执行方法，接下来就让我们真刀真枪地演练一次吧。具体来说，就是连接数据库并操作保存在表中的数据。

首先，我们编写一段程序，用它来执行一条非常简单的 SELECT 语句“SELECT 1 AScol_1”，然后把执行结果显示在画面上。这条 SQL 语句就是把常量 1 作为 1 行 1 列的结果返回的简单 SELECT 语句，并没有 FROM 子句及其之后的子句。像这样只选择常量的情况下，只用 SELECT 语句也能写出 SQL 语句。

执行上述 SQL 语句的 Java 源代码如下所示

# 代码清单 9-4 执行 SQL 语句的 Java 程序

import java. sql.\*; public class DBConnectl{ public static void main (String[] args) throws Exception { /\*1）PostgreSQL 的连接信息\*/ Statement st; ResultSet rs; String url  $=$  "jdbc:postgresql://localhost: 5432/postgres"; String user  $=$  "postgres"; String password  $=$  "test"; /\*2）定义 JDBC 驱动\*/ Class.forName ("org. postgresql. Driver");

/\*3）连接 PostgreSQL\*/con  $=$  DriverManager.getConnection (url, user, password); st  $=$  con. createStatement（);/\*4）执行 SELECT 语句\*/rs  $=$  st.executeQuery ("SELECT 1 AS col_1"); /\*5）在画面中显示结果\*/rs. next（); System.out.print (rs.getInt ("col_1")); /\*6）切断与 PostgreSQL 的连接\*/rs. close（); st. close（); 6 con. close（); 11

由于增加了处理内容，源代码也变长了。下面就让我们逐行来说明吧。我们可以像 SQL 语句那样使用  $j\star \star /$  进行注释，注释中可以使用全角字符（当然这对执行结果没有任何影响）。

# Java 是如何从数据库中获取数据的呢

首先来看第 1 行中的“importjava. sql.\*；”，它声明了连接数据库执行 SQL 语句所需要的 Java 功能。如果没有这条声明，那么下面将要讲解的 Connection 和 Statement 这些类就无法使用了。

接下来我们看一下  $①$  处，这里声明了连接数据库所需的信息（数据库的用户名和密码）以及所需的对象。下面这 3 个对象是使用 Java 连接数据库时必须要用到的，大家不妨记住它们 3 个往往是一起使用的。其他语言中也会使用名称不同但作用相似的对象。

Connection：连接，负责连接数据库 Statement：声明，负责存储和执行 SQL 语句 ResultSet：结果集，负责保存 SQL 语句的执行结果

此外，  $①$  处还定义了 url、user 和 password 这 3 个字符串。user 和 password 是连接数据库时使用的用户名和密码，这个很容易理解。

不过 url 可能理解起来就有些困难了。大家可以把它理解为数据库的“地址”，类似 Web 网站的 URL，书写时也使用斜线 / 作为分隔符。

从左往右看，“jdbc:Postgresql://”表示连接协议，也就是“使用 JDBC 来连接 PostgreSQL”的意思，跟 Web 网站的“http://”类似。

接下来的“localhost”指定了执行 PostgreSQL 操作的机器。由于我们现在使用的是本地电脑，因此使用“localhost”字符串来指定。这里使用 IP 地址“127.0.0.1”也可以实现相同的效果。在实际的系统开发中，运行 Java 程序的机器和运行数据库的机器通常是分开的，这时“localhost”就需要替换成运行数据库的机器的 IP 地址或者主机名。

接下来的“5432”表示 PostgreSQL 的端口号。端口号就像是在机器上运行的程序的门牌号。如果把 IP 地址或者主机名比作机器的名称，那么端口号就类似于房间号码。如果安装 PostgreSQL 时没有改变默认设置，那么指定成“5432”就可以了。

最后的“postgres”是 PostgreSQL 内部的数据库名称。其实我们可以在 PostgreSQL 内部创建多个数据库，不过在刚刚完成安装之后只有一个名为“postgres”的数据库，因此我们要连接的就是这个数据库。

接下来的②处定义了 JDBC 驱动，这里指明了连接时使用什么样的驱动。“org. postgresql. Driver”是 PostgreSQL 的 JDBC 驱动的类名。如果要使用其他驱动，或者使用其他 DBMS，这里的字符串也需要相应地进行修改。

然后在③处实际使用用户名和密码来连接 PostgreSQL，在④处执行 SELECT 语句，在⑤处在画面上显示执行结果。程序执行成功之后，命令提示符中会显示“1”。

# 注①

Java 对内存的管理是非常周到的，还自带了“垃圾回收”功能。该功能可以自动释放掉无用连接以及对象占用的内存，防止发生内存不足的问题，并且它在 Java 程序运行时会自动执行。不过，该功能还是无法百分之百地防止内存泄漏，因此显式地进行编码还是非常重要的。

最后在⑥处切断（关闭）与数据库的连接。之所以要切断与数据库的连接，是因为连接数据库需要占用少量内存资源，如果操作结束之后不断开连接，那么随着“残留下来”的连接不断增加，所占用的内存资源会越来越多，引发性能方面的问题。像这种由于忘记断开连接而造成的内存占用现象，称为“内存泄漏”（memory leak）。这类问题在短时间内是很难察觉的，一旦发生，想追查原因就很困难。

# 执行连接数据库的程序

下面就让我们来编译并执行一下这段源代码吧。编译的命令没有变，把源代码文件命名为“DBConnectl. java”，保存在“C：\PostgresSQL\java\src”文件夹下，然后在命令提示符中执行如下 javac 命令，就可以进行编译了。

# 编译

C:\PostgresSQL\java\jdk\bin\javac DBConnectl. java

编译时同样必须在命令提示符中移动到源代码所在的文件夹之下，不然就会发生 9- 2 节中讲到的“命令或文件名错误”。

编译成功后，源代码所在的文件夹内会生成一个名为“DBConnectl. class”的文件。与最初的示例程序一样，该文件可以通过 java 命令来执行。不过这次的命令中需要增加一个参数选项。

# 指定 JDBC 驱动文件并执行

C:\PostgresSQL\java\jdk\bin\java - cpC:\PostgresSQL\jdbc\*;. DBConnectl

# 注①

类路径也可以通过在环境变量 CLASSPATH 中进行设置，来省去输入操作。

这次我们在 java 命令和类名“DBConnectl”之间插入了“- cpC:\PostgresSQL\jdbc\*;.”这样一个字符串，这是在告诉 Java 保存 JDBC 驱动文件“postgresql- 9.4.1208. jar”的路径。“cp”是“类路径（classpath）”的缩写，也就是“类文件保存位置”的意思。大家可能会注意到：“怎么驱动文件的扩展名不是 class，而是 jar 呢？”其实 jar 文件就是多个 class 文件的集合，jar 文件的位置也是通过类路径来指定的。“C:\PostgresSQL\jdbc\*”表示包含了“C:\PostgresSQL\jdbc”文件夹下的所有文件。“\*”在 Windows 中是“全部字符串”的意思，就像“SELECT\*”表示全部列一样。最后的“;.”中，“;”是包含多个路径时的分隔符，“.”代表的是当前文件夹，用在这里就是包含“DBConnectl. class”所在文件夹的意思。

执行上述命令后，如果命令提示符中显示“1”，就代表执行成功了。

# 选取表中的数据

下面我们来编写一个从包含多条数据的表中选取数据，并且显示在画面中的程序。我们使用代码清单 1- 2 中创建的商品表（Product）作为示例用表。请大家在第 0 章创建的学习用的数据库 shop 中创建该表，我们假定使用代码清单 1- 6 中的 INSERT 语句来插入数据，最终结果如下所示。

Product 表  

<table><tr><td>product_id</td><td>product_name</td><td>product_type</td><td>sale_price</td><td>purchase_price</td><td>regist_date</td></tr><tr><td>0001</td><td>T 恤衫</td><td>衣服</td><td>1000</td><td>500</td><td>2009-09-20</td></tr><tr><td>0002</td><td>打孔器</td><td>办公用品</td><td>500</td><td>320</td><td>2009-09-11</td></tr><tr><td>0003</td><td>运动 T 恤</td><td>衣服</td><td>4000</td><td>2800</td><td></td></tr><tr><td>0004</td><td>菜刀</td><td>厨房用具</td><td>3000</td><td>2800</td><td>2009-09-20</td></tr><tr><td>0005</td><td>高压锅</td><td>厨房用具</td><td>6800</td><td>5000</td><td>2009-01-15</td></tr><tr><td>0006</td><td>叉子</td><td>厨房用具</td><td>500</td><td></td><td>2009-09-20</td></tr><tr><td>0007</td><td>擦菜板</td><td>厨房用具</td><td>880</td><td>790</td><td>2008-04-28</td></tr><tr><td>0008</td><td>圆珠笔</td><td>办公用品</td><td>100</td><td></td><td>2009-11-11</td></tr></table>

为了以防万一，我们再来介绍一下上述数据的生成步骤（代码清单 9- 5）。如果数据已经存在，那么再执行下面的 SQL 语句就会发生错误，请大家注意。

# 代码清单 9-5 创建 Product 表的 SQL 语句

- --创建数据库 shopCREATE DATABASE shop;--使用“\q”暂时从 psql 登出，再次通过命令提示符连接数据库 shopC:\PostgreSQL\9.5\bin\psql. exe 
-U postgres 
-d shop

# --创建 Product 表

CREATE TABLE Product (product_id CHAR (4) NOT NULL, product_name VARCHAR (100) NOT NULL, product_type VARCHAR (32) NOT NULL, sale_price INTEGER, purchase_price INTEGER, regist_date DATE, PRIMARY KEY (product_id));

- --插入商品数据 BEGIN TRANSACTION; INSERT INTO Product VALUES ('0001', 'T 恤衫', '衣服', 1000, 500, '2009-09-20'); INSERT INTO Product VALUES ('0002', '打孔器', '办公用品', 500, '320', '2009-09-11');

INSERT INTO Product VALUES ('0003', '运动 T 恤', '衣服', 4000, 2800, NULL); INSERT INTO Product VALUES ('0004', '菜刀', '厨房用具', 3000, 2800, '2009- 09- 20'); INSERT INTO Product VALUES ('0005', '高压锅', '厨房用具', 6800, 5000, '2009- 01- 15'); INSERT INTO Product VALUES ('0006', '叉子', '厨房用具', 500, NULL, '2009- 09- 20'); INSERT INTO Product VALUES ('0007', '擦蒸板', '厨房用具', 880, 790, '2008- 04- 28'); INSERT INTO Product VALUES ('0008', '圆珠笔', '办公用品', 100, NULL, '2009- 11- 11'); COMMIT;

表示下一行接续本行，只是由于版面所限而换行。

下面我们来尝试从这个表中选取 product_id 和 product_name 这两列的全部数据。源代码如代码清单 9- 6 所示，源文件名为“DBConnect 2. java”。

# 代码清单 9-6 从 product 表中选取 product_id 和 product_name 这两列全部数据的 Java 程序

import java. sql.*;

public class DBConnect 2{ public static void main (String[] args) throws Exception { /\*1）PostgreSQL 的连接信息\*/ Connection con; Statement st; ResultSet rs; String url  $=$  "jdbc:postgresql://localhost: 5432/shop"; String user  $=$  "postgres"; String password  $=$  "test"; /\*2）定义 JDBC 驱动\*/ Class.forName ("org. postgresql. Driver"); /\*3）连接 PostgreSQL  $\neq j$  con  $=$  DriverManager.getConnection (url, user, password); st  $=$  con. createStatement（); /\*4）执行 SELECT 语句\*/ rs  $=$  st.executeQuery ("SELECT product_id, product_name FROM Product"); /\*5）在画面中显示结果\*/ while (rs. next（)）{ System.out.print (rs.getString ("product_id") + ","); System.out.println (rs.getString ("product_name")); 1

![](https://cdn-mineru.openxlab.org.cn/result/2025-09-10/73f80d02-cbfb-4685-880f-8c0771d72bfe/2f04d5a5c69f3f1b9a1ce880dfdf942c08e2949262821aa154a4282bb11c2c42.jpg)

表示下一行接续本行，只是由于版面所限而换行。

编译并执行上述源代码之后，命令提示符中会显示如下结果。

# 执行结果

0001，T 恤衫 0002，打孔器 0003，运动 T 恤 0004，菜刀 0005，高压锅 0006，叉子 0007，擦菜板 0008，圆珠笔

编译和执行的命令如下所示。

# 编译

C:\PostgreSQL\java\jdk\bin\javac DBConnect 2. java

# 执行

C:\PostgreSQL\java\jdk\bin\java - cp C:\PostgreSQL\jdbc\*；，DBConnect 2

注意，这里在  $①$  处把表示连接信息的字符串 url 的值从"postgres”变成了“shop”。登录 PostgreSQL 的用户名仍然是之前使用的“postgres”，JDBC 驱动文件没有变化，因此  $②$  和  $(3)$  处无需改动。

接下来的  $(\widehat{4})$  处对 SELECT 语句做了改动。需要大家特别注意的是  $(5)$  处。由于需要显示多行结果，因此需要使用 while 语句逐行循环取得。

rs 就是 ResultSet（结果集）对象，用来保存 SELECT 语句的执行结果。大家可以把结果集想象成图 9- 11 那样的二元表。不过，对 Java 这样的程序语言而言，数据访问都是逐行进行的，想要处理多行数据时，就需要使用循环来实现。而 SQL 可以使用一条语句来操作多行数据，这就是 SQL 和大部分编程语言的一大区别。

![](https://cdn-mineru.openxlab.org.cn/result/2025-09-10/73f80d02-cbfb-4685-880f-8c0771d72bfe/56a635e3a7b2c119427173148ed41a8e0dba0ac2c87e44bd3325340e308f43b8.jpg)  
图 9-11 二元表形式的结果集

游标自上而下移动

“while（rs. next（）"的意思就是逐行循环访问记录，直到到达记录末尾。就像计算尺的游标一样，从上到下逐条访问结果集中的记录。

# 法则 9-4

在 Java 等程序语言的世界中，每次只能访问一条数据。因此，在访问多条数据时，需要使用循环处理。

# 更新表中的数据

最后，让我们通过 Java 来执行用于更新的 SQL 语句，以更新表中的数据。这里使用的示例程序，执行了一条删除商品表中全部数据的 DELETE 语句。源代码如代码清单 9- 7 所示，源文件名为“DBConnect 3. java”。

# 代码清单 9-7 执行用于更新的 SQL 语句来更新表中数据的 Java 程序

import java. sql.*; public class DBConnect 3 { public static void main (String[] args) throws Exception { /*1）PostgresQL 的连接信息 */ Connection con; Statement st; String url = "jdbc:postgresql://localhost: 5432/shop"; String user = "postgres"; String password = "test"; /*2）定义 JDBC 驱动 */ Class.forName ("org. postgresql. Driver");

/\*3）连接 PostgreSQL\*/con  $=$  DriverManager.getConnection (url, user, password); st  $=$  con. createStatement（);/\*4）执行 SELECT 语句  $\neq j$  int delcnt  $=$  st.executeUpdate ("DELETE FROM Product");  $(\widehat{\epsilon})$  /\*5）在画面中显示结果\*/System. out. print（delcnt\* "已删除行"）； /\*6）切断与 PostgreSQL 的连接\*/st. close（); con. close（);

源代码中发生变动的地方就是把  $④$  处的 SQL 语句变成了 DELETE 语句，以及把执行 SQL 语句的命令从 executeQuery 变成了 executeUpdate。不论 INSERT 语句还是 UPDATE 语句，Java 在执行用于更新的 SQL 语句时使用的都是 executeUpdate。此外，这里并不是要取得表中的数据，因此用不到的 ResultSet 类也一并从源代码中删除了。

编译和执行的命令如下。

# 编译

编译 C:\PostgreSQL\java\jdk\bin\javac DBConnect 3. java

# 执行

执行 C:\PostgreSQL\java\jdk\bin\java - cp C:\PostgreSQL\jdbc\*；，DBConnect 3

执行成功之后，命令提示符中会显示“8 条数据已经被删除”。虽然执行多行用于更新的 SQL 语句时还需要编写控制事务处理的代码，不过基本上变动不大。此外，通过 DBConnect 3 执行 DELETE 语句时会默认进行提交操作。

# 法则 9-5

通过使用驱动，程序可以执行包括 SELECT、DELETE、UPDATE 和 INSERT 在内的所有 SQL 语句。

# 小结

小结至此，之后无论执行多么复杂的 SQL 语句，都只需要改变④和⑤处的代码就可以了。在实际的系统中，大家可能会遇到类似于在程序中动态地组合 SQL 语句，或者把从数据库中选取的数据进行编辑后再更新数据库的情况，即使在对这些复杂的业务逻辑进行编码时，也可以以本章讲解的内容为基础。

# 练习题

练习题 9.1 通过执行 DBConnect 3，会清空 Product 表中的数据。下面我们再次使用代码清单 1- 6 中的 INSERT 语句向表中插入数据。不过这次需要请大家编写可以执行上述操作的 Java 程序，然后编译运行。

# 代码清单 1-6 向 Product 表中插入数据的 SQL 语句

INSERT INTO Product VALUES ('0001'，'T 恤衫'，'衣服'，1000，500，'2009- 09- 20'); INSERT INTO Product VALUES ('0002'，'打孔猫'，'办公用品'，500，320，'2009- 09- 11'); INSERT INTO Product VALUES ('0003'，'运动 T 恤'，'衣服'，4000，2800，NULL); INSERT INTO Product VALUES ('0004'，'菜刀'，'厨房用具'，3000，2800，'2009- 09- 20'); INSERT INTO Product VALUES ('0005'，'高压锅'，'厨房用具'，6800，5000，'2009- 01- 15'); INSERT INTO Product VALUES ('0006'，'叉子'，'厨房用具'，500，NULL，'2009- 09- 20'); INSERT INTO Product VALUES ('0007'，'擦菜板'，'厨房用具'，880，790，'2008- 04- 28'); INSERT INTO Product VALUES ('0008'，'圆珠笔'，'办公用品'，100，NULL，'2009- 11- 11');

9.2 请大家对练习题 9.1 中插入的数据进行修改。如下所示，将商品“T 恤衫”修改成“Y 恤衫”。

# 修改前

product_id|product_name|product_type|sale_price|purchase_price|regist_date 0001 T 恤衫衣服 1000 500 2009- 09- 20

# 修改后

product_id|product_name|product_type|sale_price|purchase_price|regist_date 0001 Y 恤衫衣服 1000 500 2009- 09- 20

请大家编写可以执行上述修改的 Java 程序，然后编译运行。