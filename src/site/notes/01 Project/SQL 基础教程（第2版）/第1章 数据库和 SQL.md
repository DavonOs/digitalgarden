---
{"dg-publish":true,"dg-permalink":"books/27055712/01","permalink":"/books/27055712/01/","metatags":{"description":"","og:site_name":"DavonOs","og:title":"第1章 数据库和 SQL","og:type":"article","og:url":"https://zuji.eu.org/books/27055712/01","og:image":"https://file.ituring.com.cn/LargeCover/1712477631b07b9f5895","og:image:width":"200","og:image:alt":"articlecover","og:locale":"zh_cn"},"tags":["program/sql"],"dgShowInlineTitle":true,"created":"2025-09-10 14:37","updated":"2025-10-14 09:34"}
---


## 数据库是什么

> [!todo]+ 学习重点
> - **数据库**是将大量数据保存起来，通过计算机加工而成的可以进行高效访问的数据集合。
> - 用来管理数据库的计算机系统称为**数据库管理系统**（DBMS）。
> - 通过使用 DBMS，多个用户便可安全、简单地操作大量数据。
> - 数据库有很多种类，本书将介绍如何使用专门的 SQL 语言来操作关系数据库。
> - 关系数据库通过关系数据库管理系统（RDBMS）进行管理。

### 我们身边的数据库

大家都有过下面这样的经历吧？

- 收到曾经为自己诊治过的牙医寄来的明信片，上面写着“距上次检查已有半年，请您再来做个牙齿健康检查”。
- 在生日的前一个月，收到曾入住过的旅店或宾馆发来的“生日当月入住优惠”的邮件或者明信片。
- 在网上商城购物之后，收到内附“推荐商品列表”的邮件。

这可能是因为牙医、旅店或商城的经营者掌握了顾客上一次的就诊日期、生日和购买历史等信息，并且拥有能够从大量汇总信息中快速获取所需信息（比如你的住址或爱好）的设备（计算机系统）。如果利用人工完成同样的工作，真不知道要多长时间呢。

另外，现在所有地区的图书馆都配备了计算机，实现了图书的自动查询。使用该系统，可以通过检索书名或出版年份快速查找出希望借阅的图书的所在位置，以及是否已经借出等信息。正是因为拥有了可以保存图书名称、出版年份以及保管位置和外借情况等信息，并且可以按需查询的设备，才使这一切成为可能。

像这样将大量**数据**保存起来，通过计算机加工而成的可以进行高效访问的数据集合称为**数据库**（Database，DB）。将姓名、住址、电话号码、邮箱地址、爱好和家庭构成等数据保存到数据库中，就可以随时迅速获取想要的信息了。用来管理数据库的计算机系统称为**数据库管理系统**（Database Management System，DBMS）[^1]

[^1]:数据库（DB）和 DBMS 经常被混淆。为了加以区别，本书将数据库管理系统称为 DBMS。

系统的使用者通常无法直接接触到数据库。因此，在使用系统的时候往往意识不到数据库的存在。其实大到银行账户的管理，小到手机的电话簿，可以说社会的所有系统中都有数据库的身影。
### 为什么 DBMS 那么重要

那么，为什么要使用专用系统（DBMS）来管理数据呢？我们通过计算机管理数据的时候，通常使用文本文件或者 Excel 那样的电子制表软件就可以完成了，非常简单。

确实，通过文本文件或者电子制表软件来管理数据的方法非常简便，但也有不足。下面就举几个有代表性的例子。

- 无法多人共享数据

保存在已连接网络的计算机中的文件，可以通过共享设定实现多个用户在线阅读或编辑。但是，当某个用户打开该文件的时候，其他用户就无法进行编辑了。如果是网上商城的话，当某个用户购买商品的时候，其他用户就无法购买了。

- 无法提供操作大量数据所需的格式

要想瞬间从几十万或者上百万的数据中获取想要的数据，必须把数据保存为适当的格式，但是文本文件和 Excel 工作表等无法提供相应的格式。

- 实现读写自动化需要编程能力

通过编写计算机程序（以下简称程序）可以实现数据读取和编辑自动化，但这必须以了解数据结构为前提，还需具备一定的计算机编程技术。

- 无法应对突发事故

当文件被误删、硬盘出现故障等导致无法读取的时候，可能会造成重要数据丢失，同时数据还可能被他人轻易读取或窃用。

DBMS 可以克服这些不足，实现多个用户同时安全简单地操作大量数据（图 1- 2）。这也是我们一定要使用 DBMS 的原因。

![](https://cdn-mineru.openxlab.org.cn/result/2025-09-10/73f80d02-cbfb-4685-880f-8c0771d72bfe/a083356eefab99854aec5702863264ae9804214299d12964c3d5ca0ee16e242d.jpg)
图 1-2 DBMS 能够实现多个用户同时安全简单地操作大量数据

### DBMS 的种类

DBMS 主要通过数据的保存格式（数据库的种类）来进行分类，现阶段主要有以下 5 种类型。

- **层次数据库**（HierarchicalDatabase，HDB）
最古老的数据库之一，它把数据通过层次结构（树形结构）的方式表现出来。层次数据库曾经是数据库的主流，但随着关系数据库的出现和普及，现在已经很少使用了。

- **关系数据库**（Relational Database，RDB）
关系数据库是现在应用最广泛的数据库。关系数据库在 1969 年诞生，可谓历史悠久。和 Excel 工作表一样，它也采用由**行和列组成的二维表来管理数据**，所以简单易懂（表 1-1）。同时，它还使用专门的 **SQL**（Structured Query Language，结构化查询语言）对数据进行操作。

表 1-1 关系数据库中的数据

| 商品编号 | 商品名称   | 商品种类 | 销售单价 | 进货单价 | 登记日期       |
| ---- | ------ | ---- | ---- | ---- | ---------- |
| 0001 | T 恤衫   | 衣服   | 1000 | 500  | 2009-09-20 |
| 0002 | 打孔器    | 办公用品 | 500  | 320  | 2009-09-11 |
| 0003 | 运动 T 恤 | 衣服   | 4000 | 2800 |            |
| 0004 | 菜刀     | 厨房用具 | 3000 | 2800 | 2009-09-20 |
| 0005 | 高压锅    | 厨房用具 | 6800 | 5000 | 2009-01-15 |
| 0006 | 叉子     | 厨房用具 | 500  |      | 2009-09-20 |
| 0007 | 擦菜板    | 厨房用具 | 880  | 790  | 2008-04-28 |
| 0008 | 圆珠笔    | 办公用品 | 100  |      | 2009-11-11 |

这种类型的 DBMS 称为关系数据库管理系统（RelationalDatabaseManagementSystem，RDBMS）。比较具有代表性的 RDBMS 有如下 5 种。
- OracleDatabase：甲骨文公司的 RDBMS
- SQLServer：微软公司的 RDBMS
- DB2：IBM 公司的 RDBMS
- PostgreSQL：开源的 RDBMS
- MySQL：开源的 RDBMS

另外，Oracle Database 通常简称为 Oracle，因此，本书在接下来的章节中也使用这一简称。

- **面向对象数据库**（Object Oriented Database，OODB）
编程语言当中有一种被称为面向对象语言的语言。把数据以及对数据的操作集合起来以对象为单位进行管理，因此得名。面向对象数据库就是用来保存这些对象的数据库。

- **XML 数据库**（XML Database，XMLDB）
最近几年，XML 作为在网络上进行交互的数据的形式逐渐普及起来。XML 数据库可以对 XML 形式的大量数据进行高速处理。

- **键值存储系统**（Key-Value Store，KVS）
这是一种单纯用来保存查询所使用的主键（Key）和值（Value）的组合的数据库。具有编程语言知识的读者可以把它想象成关联数组或者散列（hash）。近年来，随着键值存储系统被应用到 Google 等需要对大量数据进行超高速查询的 Web 服务当中，它正逐渐为人们所关注。

本书将向大家介绍使用 SQL 语言的数据库管理系统，也就是关系数据库管理系统（RDBMS）的操作方法。接下来还会深入讲解 RDBMS。如无特殊说明，本书所提到的数据库以及 DBMS 都是指 RDBMS。

另外，有的 RDBMS 也可以像 XML 数据库那样操作 XML 形式的数据，或者具有面向对象数据库的功能。本书并不会介绍用于这些扩展功能的 SQL，如果要了解这些内容，请参考 RDBMS 附带的 SQL 手册或者针对不同的 RDBMS 介绍 SQL 的图书。

## 数据库的结构

> [!todo]+ 学习重点
> - RDBMS 通常使用客户端/服务器这样的系统结构。
> - 通过从客户端向服务器端发送 SQL 语句来实现数据库的读写操作。
> - 关系数据库采用被称为数据库表的二维表来管理数据。
> - 数据库表由表示数据项目的列（字段）和表示一条数据的行（记录）所组成，以记录为单位进行数据读写。
> - 本书将行和列交汇的方格称为单元格，每个单元格只能输入一个数据。

### RDBMS 的常见系统结构

使用 RDBMS 时，最常见的系统结构就是客户端/服务器类型（C/S 类型）这种结构（图 1-3）。

![](https://cdn-mineru.openxlab.org.cn/result/2025-09-10/73f80d02-cbfb-4685-880f-8c0771d72bfe/5015c1a590f0d8b4aab3bc41012ce6470656f355f3943b2290fb438e337a5294.jpg)
图 1-3 使用 RDBMS 时的系统结构

服务器指的是用来接收其他程序发出的请求，并对该请求进行相应处理的程序（软件），或者是安装了此类程序的设备（计算机）。在计算机上持续执行处理，并等待接收下一条请求。RDBMS 也是一种服务器，它能够从保存在硬盘上的数据库中读取数据并返回，还可以把数据变更为指定内容。

与之相对，向服务器发出请求的程序（软件），或者是安装了该程序的设备（计算机）称为客户端。访问由 RDBMS 管理的数据库，进行数据读写的程序称为 RDBMS 客户端。RDBMS 客户端将想要获取什么样的数据，或者想对哪些数据进行何种变更等信息通过 SQL 语句发送给 RDBMS 服务器。RDBMS 根据该语句的内容返回所请求的数据，或者对存储在数据库中的数据进行更新。

客户端就如同委托方，而服务器就像是受托方。由于两者关系类似受托方执行委托方发出的指令，故而得名。

这样就可以使用 SQL 语句来实现关系数据库的读写操作了。本书为了给大家讲解 SQL，使用了可以显示如何将 SQL 语句发送到 RDBMS，以及接收返回信息（数据）的客户端。具体内容请参考[[01 Project/SQL 基础教程（第2版）/第0章 绪论——搭建 SQL 的学习环境\|第0章]]。

另外，RDBMS 既可以和其客户端安装在同一台计算机上，也可以分别安装在不同的计算机上。这样一来，不仅可以通过网络使二者相互关联，还可以实现多个客户端访问同一个 RDBMS（图 1- 4）。

![](https://cdn-mineru.openxlab.org.cn/result/2025-09-10/73f80d02-cbfb-4685-880f-8c0771d72bfe/e06f38e68bb35d6d37a84dc410dd682cd28eaa1ef589f23fd0c4a6f1e9781f3b.jpg)
图 1-4 通过网络可以实现多个客户端访问同一个数据库

客户端没有必要使用同样的程序，只要能将 SQL 发送给 RDBMS，就可以操作数据库了。并且，多个客户端还可以同时对同一个数据库进行读写操作。

另外，RDBMS 除了需要同时接收多个客户端的请求之外，还需要操作存有大量数据的数据库，因此通常都会安装在比客户端性能更优越的计算机上。操作数据量特别巨大的数据库时，还可以将多台计算机组合使用。

虽然 RDBMS 的系统结构多种多样，但是从客户端发来的 SQL 语句基本上都是一样的。

### 表的结构

让我们再具体了解一下 RDBMS 的结构。上一节我们讲到了关系数据库通过类似 Excel 工作表那样的、由行和列组成的二维表来管理数据。用来管理数据的二维表在关系数据库中简称为表。

表存储在由 RDBMS 管理的数据库中，如图 1- 5 所示。一个数据库中可以存储多个表。

![](https://cdn-mineru.openxlab.org.cn/result/2025-09-10/73f80d02-cbfb-4685-880f-8c0771d72bfe/0224e6e99131c5235eb5be992f55bc73fd343dcbdf0c4773b3ad38c6c550caf6.jpg)
图 1-5 数据库和表的关系

根据 SQL 语句的内容返回的数据同样必须是二维表的形式，这也是关系数据库的特征之一。返回结果如果不是二维表的 SQL 语句则无法执行。

另外，图 1-5 中只有一个数据库，我们还可以创建多个数据库分别用于不同用途。

图 1-6 所示为 1-3 节之后的学习中实际用到的商品表的内容。
![878X483/屏幕截图_10-9-2025_17244_.webp](https://tc-new.z.wiki/autoupload/f/R3qf6-Uz14T45NdY61DrL5_VONeOs-OX4FejmDBzFxuyl5f0KlZfm6UsKj-HyTuv/20250910/lYT1/878X483/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE_10-9-2025_17244_.webp)
图 1-6 表的示例（商品表）

表的列（垂直方向）称为字段，它代表了保存在表中的数据项目。在表 1- 2 的商品表中，从商品编号到登记日期一共有 6 列。对于列的约束比 Excel 更加严格，定义为数字的列只能输入数字，定义为日期的列只能输入日期（将在[[ #表的创建 \|1-4 节]]详细介绍）。

与之相对，表的行（水平方向）称为记录，它相当于一条数据。商品表中总共有 8 行数据。关系数据库必须以行为单位进行数据读写，请大家牢记。

> [!example]+ 法则 1-1
关系数据库以行为单位读写数据

本书将图 1-6 所示的行和列交汇的方格称为单元格。一个单元格中只能输入一个数据。像图 1-7 那样，在一个单元格中输入 2 个或 2 个以上的数据是不允许的，请大家牢记。

![761X218/屏幕截图_10-9-2025_172915_.webp](https://tc.z.wiki/autoupload/f/R3qf6-Uz14T45NdY61DrL5_VONeOs-OX4FejmDBzFxuyl5f0KlZfm6UsKj-HyTuv/20250910/cMPB/761X218/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE_10-9-2025_172915_.webp)
图 1-7 一个单元格中只能输入一个数据

> [!example]+ 法则 1-2
> 一个单元格中只能输入一个数据。

> [!quote]+ 专栏
> <center>RDBMS 的用户管理</center>
> 为了防止重要数据被窃读或篡改，RDBMS 只允许注册用户接触数据库。这里的用户并不是指 Windows 等操作系统的注册用户，而是只能用于 RDBMS 的用户。RDBMS 允许注册多个用户。<br>
> 注册用户的时候除了设定用户名（账号），还需要设定密码。虽然密码并不是必需的，但为了防止重要信息的泄露，还是希望大家能够设定密码。


## SQL 概要

> [!todo]+ 学习要点
> - SQL 是为操作数据库而开发的语言。
> - 虽然 SQL 也有标准，但实际上根据 RDBMS 的不同 SQL 也不尽相同。
> - SQL 通过一条语句来描述想要进行的操作，发送给 RDBMS。
> - 原则上 SQL 语句都会使用分号结尾。
> - SQL 根据操作目的可以分为 DDL、DML 和 DCL。

### 标准 SQL

如前所述，本书所要学习的 SQL 是用来操作关系数据库的语言。它原本是为了提高数据库查询效率而开发的语言，但是现在不仅可以进行数据查询，就连数据的插入和删除等操作也基本上都可以通过 SQL 来完成了。

国际标准化组织（ISO）为 SQL 制定了相应的标准，以此为基准的 SQL 称为标准 SQL（相关信息请参考专栏——标准 SQL 和特定的 SQL）。以前，完全基于标准 SQL 的 RDBMS 很少，通常需要根据不同的 RDBMS 来编写特定的 SQL 语句。这样一来，就会造成能够在 Oracle 中使用的 SQL 语句却无法在 SQL Server 中使用，反之亦然。近来，对标准 SQL 的支持取得了一些进展，因此希望准备学习 SQL 的读者们能够从现在开始就牢记标准 SQL 的书写方式。

原则上，本书介绍的都是标准 SQL[^2] 的书写方式，但是根据 RDBMS 的不同也会存在一些特殊的 SQL 语句。如果遇到这种情况，将会通过其他途径对其进行说明。

[^2]: 本书将介绍以`[SQL:2003]`为基准的标准 SQL 的书写方式。

> [!example]+ 法则 1-3
> 学会标准 SQL 就可以在各种 RDBMS 中书写 SQL 语句了。

### SQL 语句及其种类

SQL 用关键字、表名、列名等组合而成的一条语句（SQL 语句）来描述操作的内容。关键字是指那些含义或使用方法已事先定义好的英语单词，存在包含“对表进行查询”或者“参考这个表”等各种意义的关键字。

根据对 RDBMS 赋予的指令种类的不同，SQL 语句可以分为以下三类。

**DDL**（DataDefinitionLanguage，数据定义语言）
用来创建或者删除存储数据用的数据库以及数据库中的表等对象。DDL 包含以下几种指令：

- CREATE：创建数据库和表等对象
- DROP： 删除数据库和表等对象
- ALTER：修改数据库和表等对象的结构

**DML**（DataManipulationLanguage，数据操纵语言）
用来查询或者变更表中的记录。DML 包含以下几种指令：

- SELECT：查询表中的数据
- INSERT：向表中插入新数据
- UPDATE：更新表中的数据
- DELETE：删除表中的数据

**DCL**（DataControlLanguage，数据控制语言）
用来确认或者取消对数据库中的数据进行的变更。除此之外，还可以对 RDBMS 的用户是否有权限操作数据库中的对象（数据库表等）进行设定。DCL 包含以下几种指令：

- COMMIT： 确认对数据库中的数据进行的变更
- ROLLBACK：取消对数据库中的数据进行的变更
- GRANT： 赋予用户操作权限
- REVOKE： 取消用户的操作权限

实际使用的 SQL 语句当中有90%属于 DML，本书同样会以 DML 为中心进行讲解。

> [!example]+ 法则 1-4
> SQL 根据功能不同可以分为三类，其中使用最多的是 DML。

### SQL 的基本书写规则

书写 SQL 语句时必须要遵守一些规则。这些规则都非常简单，接下来就让我们逐一认识一下吧。

- SQL 语句要以分号（`;`）结尾

一条 SQL 语句可以描述一个数据库操作。在 RDBMS 当中，SQL 语句也是逐条执行的。

众所周知，我们在句子的句尾加注标点表示结束，中文句子以句号（`。`）结尾，英文以点号（`. `）结尾，而 SQL 语句则使用分号（`;`）结尾。

> [!example]+ 法则 1-5
> SQL 语句以分号（`;`）结尾。

- SQL 语句不区分大小写

SQL 不区分关键字的大小写。例如，不管写成 `SELECT` 还是 `select`，解释都是一样的。表名和列名也是如此。

虽然可以根据个人喜好选择大写还是小写（或大小写混杂），但为了理解起来更加容易，本书使用以下规则来书写 SQL 语句。

- 关键字大写
- 表名的首字母大写
- 其余（列名等）小写

> [!example]+ 法则 1-6
> 关键字不区分大小写。

但是插入到表中的数据是区分大小写的。例如，在操作过程中，数据 Computer、COMPUTER 或 computer，三者是不一样的。

- 常数的书写方式是固定的

SQL 语句常常需要直接书写字符串、日期或者数字。例如，书写向表中插入字符串、日期或者数字等数据的 SQL 语句。

在 SQL 语句中直接书写的字符串、日期或者数字等称为常数。常数的书写方式如下所示。

SQL 语句中含有字符串的时候，需要像 `'abc'` 这样，使用单引号（` ' `）将字符串括起来，用来标识这是一个字符串。

SQL 语句中含有日期的时候，同样需要使用单引号将其括起来。日期的格式有很多种（'26 Jan 2010'或者'10/01/26'等），本书统一使用 `'2010-01-26'` 这种 `'年-月-日'` 的格式。

在 SQL 语句中书写数字的时候，不需要使用任何符号标识，直接写成 1000 这样的数字即可。

> [!example]+ 法则 1-7
> 字符串和日期常数需要使用单引号（`'`）括起来。<br>
> 数字常数无需加注单引号（直接书写数字即可）。

- 单词需要用半角空格或者换行来分隔

SQL 语句的单词之间需使用半角空格或换行符来进行分隔。如下这种未加分隔的语句会发生错误，无法正常执行。

✅CREATE TABLE Product
❌CREATETABLE Product
❌CREATE TABLEProduct

但是不能使用全角空格作为单词的分隔符，否则会发生错误，出现无法预期的结果。

> [!example]+ 法则 1-8
> 单词之间需要使用半角空格或者换行符进行分隔

> [!quote]+ 专栏
> <center>标准 SQL 和特定的 SQL</center>
> 每隔几年，ANSI（美国国家标准协会）或 ISO（国际标准化组织）等便会修订 SQL 的标准，进行语法的修订并追加新功能。<br>
> 1986 年，ANSI 首次制定了 SQL 的标准，之后又进行了数次修订。本书编写时（2016 年 5 月）使用的是 2011 年修订的最新版本（SQL:2011）。修订后的标准以修订年份来命名，例如 SQL: 1999、SQL: 2003、SQL: 2008 等。以这些标准为基准的 SQL 就是标准 SQL。<br>
> 但是，SQL 的标准并不强制“每种 RDBMS 都必须使用”。虽然支持标准 SQL 的 RDBMS 越来越多，但还是存在标准 SQL 无法执行的情况。这时就需要使用只能在特定 RDBMS 中使用的特殊 SQL 语句。<br>
> 其实，这也是没有办法的事情，起初（大约在 20 世纪 80 年代到 90 年代），标准 SQL 能够实现的功能非常有限，无法完全满足实际需要。RDBMS 的供应商为了弥补这些不足，不得不再单独追加所需要的功能。<br>
> 尽管如此，这些特定的 SQL 所带来的并不都是负面的影响。标准 SQL 将一些独特的功能收录其中，对其自身的发展起到了积极的推进作用。过去，各个供应商为了展现本公司的优势和独特性，也曾不遗余力地开发各自特定的 SQL。<br>
> 目前的标准 SQL 经过多次修订，功能已经十分完善。准备学习 SQL 的读者们，就让我们先从牢记标准 SQL 的书写方法开始吧。

## 表的创建

> [!todo]+ 学习要点
> - 表通过 CREATE TABLE 语句创建而成。
> - 表和列的命名要使用有意义的文字。
> - 指定列的数据类型（整数型、字符型和日期型等）。
> - 可以在表中设置约束（主键约束和 NOT NULL 约束等）。

### 表的内容的创建

我们将从第 2 章开始学习针对表的查询，以及数据变更等 SQL 语句。本节将会创建学习这些 SQL 语句所需的数据库和表。

表 1-2 是 1- 2 节举例时使用的商品表。

表 1-2 商品表

| 商品编号 | 商品名称   | 商品种类 | 销售单价 | 进货单价 | 登记日期       |
| ---- | ------ | ---- | ---- | ---- | ---------- |
| 0001 | T 恤衫   | 衣服   | 1000 | 500  | 2009-09-20 |
| 0002 | 打孔器    | 办公用品 | 500  | 320  | 2009-09-11 |
| 0003 | 运动 T 恤 | 衣服   | 4000 | 2800 |            |
| 0004 | 菜刀     | 厨房用具 | 3000 | 2800 | 2009-09-20 |
| 0005 | 高压锅    | 厨房用具 | 6800 | 5000 | 2009-01-15 |
| 0006 | 叉子     | 厨房用具 | 500  |      | 2009-09-20 |
| 0007 | 擦菜板    | 厨房用具 | 880  | 790  | 2008-04-28 |
| 0008 | 圆珠笔    | 办公用品 | 100  |      | 2009-11-11 |
该表是某家小商店销售商品的一览表。商品的数量不多，不过我们可以把它想象成大量数据中的一部分（毕竟这只是为了学习 SQL 而创建的表）。像 0003 号商品的登记日期以及 0006 号商品的进货单价这样的空白内容，我们可以认为是由于店主疏忽而忘记输入了。

大家可以看到表 1-2 由 6 列 8 行所组成。最上面一行是数据的项目名，真正的数据是从第 2 行开始的。

> [!tip]+ 备忘
> 接下来，我们会逐步学习创建数据库和表所使用的 SQL 语句的书写方式。还没有准备好学习环境（PostgreSQL）的读者，请按照第 0 章的内容进行准备。

### 数据库的创建（CREATE DATABASE 语句）

前面提到，在创建表之前，一定要先创建用来存储表的数据库。运行 **CREATE DATABASE 语句**就可以在 RDBMS 上创建数据库了。CREATE DATABASE 语句的语法如下所示。

语法 1-1 创建数据库的 CREATE DATABASE 语句
```sql
CREATE DATABASE <数据库名称>;
```


这里我们将数据库命名为 shop，然后执行代码清单 1-1 中的 SQL 语句。这里我们仅指定了使用该语法所需的最少项目，实际开发数据库时还需要指定各种其他项目。


代码清单 1-1 创建数据库 shop 的 CREATE DATABASE 语句
```sql
CREATE DATABASE shop;
```

此外，数据库名称、表名以及列名都要使用半角字符（英文字母、数字、符号），具体内容随后会进行介绍。

### 表的创建（CREATE TABLE 语句）

创建好数据库之后，接下来我们使用 **CREATE TABLE 语句**在其中创建表。CREATE TABLE 语句的语法如下所示。

语法 1-2 创建表的 CREATE TABLE 语句
```sql
CREATE TABLE <表名>
（<列名1> <数据类型> <该列所需约束>，
<列名2> <数据类型> <该列所需约束>，
<列名3> <数据类型> <该列所需约束>，
<列名4> <数据类型> <该列所需约束>，
.
.
.
<该表的约束1>，<该表的约束2>，...);
```

该语法清楚地描述了我们要创建一个包含 < 列名1>、< 列名2>、的名称为 < 表名 > 的表，非常容易理解。每一列的数据类型（后述）是必须要指定的，还要为需要的列设置约束（后述）。约束可以在定义列的时候进行设置，也可以在语句的末尾进行设置[^3]。

[^3]:但是 NOT NULL 约束只能以列为单位进行设置。

在数据库中创建表 1- 2 中的商品表（Product 表）的 CREATE TABLE 语句，如代码清单 1- 2 所示。

代码清单 1-2 创建 Product 表的 CREATE TABLE 语句

```sql
CREATE TABLE Product
(product_id CHAR (4) NOT NULL,
product_name VARCHAR (100) NOT NULL,
product_type VARCHAR (32) NOT NULL,
sale_price INTEGER ,
purchase_price INTEGER ,
regist_date DATE ,
PRIMARY KEY (product_id));
```


> [!tip]+ 备忘
> 本书将陆续创建出 Product 表等学习中用到的一些示例表。创建这些表的 SQL 语句保存在本书示例程序 `\Sample\CreateTable\<RDBMS 名 >` 文件夹下的 `CreateTable<表名>.sql` 文件中。例如在 PostgreSQL 中创建 Product 表所使用的 SQL 语句，就保存在本书示例代码 `\Sample\CreateTable\PostgreSQL` 文件夹下的 `CreateTableProduct.sql` 文件中。
`CreateTableProduct.sql` 文件包含了创建 Product 表时用到的 SQL 语句（代码清单 1-2），以及向 Product 表中插入数据的 SQL 语句（代码清单 1-6）。这样就可以在创建表的同时向表中预先插入数据了。

### 命名规则

我们只能使用半角英文字母、数字、下划线（`_`）作为数据库、表和列的名称。例如，不能将 `product_id` 写成 `product-id`，因为标准 SQL 并不允许使用连字符作为列名等名称。$、#、？这样的符号同样不能作为名称使用。

尽管有些 RDBMS 允许使用上述符号作为列的名称，但这也仅限于在该 RDBMS 中使用，并不能保证在其他 RDBMS 中也能使用。虽然大家可能会觉得限制有点太多了，但还是请遵守规则使用半角英文字母、数字和下划线（`_`）吧。

> [!example]+ 法则 1-9
> 数据库名称、表名和列名等可以使用以下三种字符。
> - 半角英文字母
> - 半角数字
> - 下划线（`_`）

此外，名称必须以半角英文字母开头。以符号开头的名称并不多见，但有时会碰到类似 1 product 或者 2009_sales 这样以数字开头的名称。虽然可以理解，但这在标准 SQL 中是被禁止的。请大家使用 product 1 或者 sales_2009 这样符合规则的名称。

> [!example]+ 法则 1-10
> 名称必须以半角英文字母作为开头。

最后还有一点，在同一个数据库中不能创建两个相同名称的表，在同一个表中也不能创建两个名称相同的列。如果出现这样的情况，RDBMS 会返回错误信息。

> [!example]+ 法则 1-11
> 名称不能重复。

接下来我们根据上述规则，使用代码清单 1-2 中的 CREATE TABLE 语句来创建表 1-2 中的商品表。表名为 Product，表中的列名如表 1-3 所示。

表 1-3 商品表和 Product 表列名的对应关系

| 商品表中的列名 | Product 表定义的列名 |
| ------- | -------------- |
| 商品编号    | product_id     |
| 商品名称    | product_name   |
| 商品种类    | product_type   |
| 销售单价    | sale_price     |
| 进货单价    | purchase_price |
| 登记日期    | regist_date    |

### 数据类型的指定

Product 表所包含的列，定义在 `CREATE TABLE Product()`的括号中。列名右边的 INTEGER 或者 CHAR 等关键字，是用来声明该列的数据类型的，所有的列都必须指定数据类型。

数据类型表示数据的种类，包括数字型、字符型和日期型等。每一列都不能存储与该列数据类型不符的数据。声明为整数型的列中不能存储'abc'这样的字符串，声明为字符型的列中也不能存储 1234 这样的数字。

数据类型的种类很多，各个 RDBMS 之间也存在很大差异。根据业务需要实际创建数据库时，一定要根据不同的 RDBMS 选用最恰当的数据类型。在学习 SQL 的时候，使用最基本的数据类型就足够了。下面我们就来介绍四种基本的数据类型。

#### ● INTEGER 型

用来指定存储整数的列的数据类型（数字型），不能存储小数。

#### ● CHAR 型

CHAR 是 CHARACTER（字符）的缩写，是用来指定存储字符串的列的数据类型（字符型）。可以像 CHAR（10）或者 CHAR（200）这样，在括号中指定该列可以存储的字符串的长度（最大长度）。字符串超出最大长度的部分是无法输入到该列中的。RDBMS 不同，长度单位也不一样，既存在使用字符个数的情况，也存在使用字节长度的情况。

字符串以**定长字符串**的形式存储在被指定为 CHAR 型的列中。所谓定长字符串，就是当列中存储的字符串长度达不到最大长度的时候，使用半角空格进行补足。例如，我们向 CHAR（8）类型的列中输入 `'abc'` 的时候，会以 ` 'abc     ' `（abc 后面有 5 个半角空格）的形式保存起来。

另外，虽然之前我们说过 SQL 不区分英文字母的大小写，但是表中存储的字符串却是区分大小写的。也就是说，'ABC'和'abc'代表了两个不同意义的字符串。

#### ● VARCHAR 型

同 CHAR 类型一样，VARCHAR 型也是用来指定存储字符串的列的数据类型（字符串类型），也可以通过括号内的数字来指定字符串的长度（最大长度）。但该类型的列是以**可变长字符串**的形式来保存字符串的[^4]。定长字符串在字符数未达到最大长度时会用半角空格补足，但可变长字符串不同，即使字符数未达到最大长度，也不会用半角空格补足。例如，我们向 VARCHAR（8）类型的列中输入字符串'abc'的时候，保存的就是字符串'abc'。

该类型的列中存储的字符串也和 CHAR 类型一样，是区分大小写的。

[^4]:VARCHAR 中的 VAR 是 VARING（可变的）的缩写。

> 特定的 SQL
> Oracle 中使用 VARCHAR 2 型（Oracle 中也有 VARCHAR 这种数据类型，但并不推荐使用）。

#### ● DATE 型

用来指定存储日期（年月日）的列的数据类型（日期型）。

> 特定的 SQL
> 除了年月日之外，Oracle 中使用的 DATE 型还包含时分秒，但在本书中我们只学习日期部分。

### 约束的设置

**约束**是除了数据类型之外，对列中存储的数据进行限制或者追加条件的功能。Product 表中设置了两种约束。

Product 表的 product_id 列、product_name 列和 product_type 列的定义如下所示。

```sql
product_id CHAR (4) NOT NULL,
product_name VARCHAR (100) NOT NULL,
product_type VARCHAR (32) NOT NULL,
```

数据类型的右侧设置了 **NOT NULL 约束**。NULL 是代表空白（无记录）的关键字。在 NULL 之前加上了表示否定的 NOT，就是给该列设置了不能输入空白，也就是必须输入数据的约束（如果什么都不输入就会出错）。

这样一来，Product 表的 product_id（商品编号）列、product_name（商品名称）列和 product_type（商品种类）列就都成了必须输入的项目。

另外，在创建 Product 表的 CREATE TABLE 语句的后面，还有下面这样的记述。

`PRIMARY KEY (product_id)`

这是用来给 product_id 列设置**主键约束**的。所谓**键**，就是在指定特定数据时使用的列的组合。键种类多样，**主键**（primary key）就是可以特定一行数据的列。也就是说，如果把 product_id 列指定为主键，就可以通过该列取出特定的商品数据了。

反之，如果向 product_id 列中输入了重复数据，就无法取出唯一的特定数据了（因为无法确定唯一的一行数据）。这样就可以为某一列设置主键约束了。
## 表的删除和更新

> [!todo]+ 学习要点
> - 使用 DROP TABLE 语句来删除表。
> - 使用 ALTER TABLE 语句向表中添加列或者从表中删除列。

### 表的删除（DROP TABLE 语句）

此前介绍的都是关于 Product 表的内容的创建，下面我们就来介绍一下删除表的方法。删除表的 SQL 语句非常简单，只需要一行 **DROP TABLE 语句**即可。

语法 1-3 删除表时使用的 DROP TABLE 语句
```sql
DROP TABLE <表名>；
```

如果想要删除 Product 表，只需要像代码清单 1- 3 那样书写 SQL 语句即可。

代码清单 1-3 删除 Product 表
`DROP TABLE Product;`

DROP 在英语中是“丢掉”“舍弃”的意思。需要特别注意的是，删除的表是无法恢复的。即使是被误删的表，也无法恢复，只能重新创建，然后重新插入数据。

如果不小心删除了重要的业务表，那就太悲剧了。特别是存储了大量数据的表，恢复起来费时费力，请大家务必注意！

> [!example]+ 法则 1-12
> 删除了的表是无法恢复的。在执行 `DROP TABLE` 语句之前请务必仔细确认。

### 表定义的更新（ALTER TABLE 语句）

有时好不容易把表创建出来之后才发现少了几列，其实这时无需把表删除再重新创建，只需使用变更表定义的 **ALTER TABLE 语句**就可以了。ALTER 在英语中就是“改变”的意思。下面就给大家介绍该语句通常的使用方法。

首先是添加列时使用的语法。

语法 1-4 添加列的 ALTER TABLE 语句
```sql
ALTER TABLE <表名> ADD COLUMN <列的定义>;
```

> 特定的 SQL
> Oracle 和 SQL Server 中不用写 COLUMN。
> `ALTER TABLE <表名> ADD <列名>;`
> 另外，在 Oracle 中同时添加多列的时候，可以像下面这样使用括号。
> `ALTER TABLE <表名> ADD (<列名>, <列名>, ……)`

例如，我们可以使用代码清单 1-4 中的语句在 Product 表中添加这样一列，product_name_pinyin（商品名称（拼音)），该列可以存储 100 位的可变长字符串。

代码清单 1- 4 添加一列可以存储 100 位的可变长字符串的 product_name_pinyin 列
```PostgreSQL MySQL DB2
ALTER TABLE Product ADD COLUMN product_name_pinyin VARCHAR (100);
```

```Oracle
ALTER TABLE Product ADD (product_name_pinyin VARCHAR 2 (100));
```

```SQL Server
ALTER TABLE Product ADD product_name_pinyin VARCHAR (100);
```

反之，删除表中某列使用的语法如下所示：

语法 1-5 删除列的 ALTER TABLE 语句
```sql
ALTER TABLE <表名> DROP COLUMN <列名>;
```

> 特定的 SQL
> Oracle 中不用写 COLUMN。
> `ALTER TABLE <表名> DROP <列名>；`
> 另外，在 Oracle 中同时删除多列的时候，可以像下面这样使用括号来实现。
> `ALTER TABLE <表名> DROP (<列名>, <列名>, ……);`

例如，我们可以使用代码清单 1- 5 中的语句来删除之前添加的 product_name_pinyin 列。

代码清单 1-5 删除 product_name_pinyin 列

```PostgreSQL MySQL SQL Server DB2
ALTER TABLE Product DROP COLUMN product_name_pinyin;
```

```Oracle
ALTER TABLE Product DROP (product_name_pinyin);
```

ALTER TABLE 语句和 DROP TABLE 语句一样，执行之后无法恢复。误添的列可以通过 ALTER TABLE 语句删除，或者将表全部删除之后重新再创建。

> [!example]+ 法则 1-13
> 表定义变更之后无法恢复。在执行 ALTER TABLE 语句之前请务必仔细确认。

### 向 Product 表中插入数据

最后让我们来尝试一下向表中插入数据。从下一章开始，大家将会使用插入到 Product 表中的数据，来学习如何编写操作数据的 SQL 语句。

向 Product 表中插入数据的 SQL 语句如代码清单 1- 6 所示。

代码清单 1-6 向 Product 表中插入数据的 SQL 语句
```PostgreSQL SQL Server
-- DML：插入数据
BEGIN TRANSACTION;------①

INSERT INTO Product VALUES ('0001', 'T 恤衫', '衣服', 1000, 500, '2009-09-20');
INSERT INTO Product VALUES ('0002', '打孔器', '办公用品', 500, 320, '2009-09-11');
INSERT INTO Product VALUES ('0003', '运动 T 恤', '衣服', 4000, 2800, NULL);
INSERT INTO Product VALUES ('0004', '菜刀', '厨房用具', 3000, 2800, '2009-09-20');
INSERT INTO Product VALUES ('0005', '高压锅', '厨房用具', 6800, 5000, '2009-01-15');
INSERT INTO Product VALUES ('0006', '叉子', '厨房用具', 500, NULL, '2009-09-20');
INSERT INTO Product VALUES ('0007', '擦菜板', '厨房用具', 880, 790, '2008-04-28');
INSERT INTO Product VALUES ('0008', '圆珠笔', '办公用品', 100, NULL, '2009-11-11');

COMMIT;
```

> 特定的 SQL
> DBMS 不同，代码清单 1- 6 中的 DML 语句也略有不同。在 MySQL 中运行时，需要把①中的 BEGIN TRANSACTION；改写成：`START TRANSACTION;`
> 
> 在 Oracle 和 DB2 中运行时，无需使用①中的 BEGIN TRANSACTION；（请予以删除）。这些在不同的 DBMS 中使用的 DML 语句，都保存在本书示例程序 `Sample\CreateTable\<RDBMS名>` 文件夹下的 `CreateTableProduct.sql` 文件中。

使用插入行的指令语句 INSERT，就可以把表 1-2 中的数据都插入到表中了。开头的 BEGIN TRANSACTION 语句是开始插入行的指令语句，结尾的 COMMIT 语句是确定插入行的指令语句。这些指令语句将会在[[01 Project/SQL 基础教程（第2版）/第4章 数据更新\|第 4 章]] 详细介绍，大家不必急于记住这些语句。

> [!quote]+ 专栏
> <center>表的修改</center>
> 本节将名为 Product 的表作为例子进行了讲解，估计会有些读者在匆忙中把表名误写成了 Poduct，创建出了名称错误的表，这可怎么办呢？
> 
> 如果还没有向表中插入数据，那么只需要把表删除，再重新创建一个名称正确的表就可以了。可是如果在发现表名错误之前就已经向表中插入了大量数据，再这样做就麻烦了。毕竟插入大量的数据既费时又费力。抑或起初决定好的表名，之后又觉得不好想换掉，这种情况也很麻烦。
> 
> 其实很多数据库都提供了可以修改表名的指令（RENAME）来解决这样的问题。例如，如果想把 Poduct 表的名称变为 Product，可以使用代码清单 1-A 中的指令。
> 
> 代码清单 1-A 变更表名
> ```PostgreSQL Oracle
> ALTER TABLE Poduct RENAME TO Product;
> ```
> ```DB2
> RENAME TABLE Poduct TO Product;
> ```
> ```SQL Server
> sp_rename 'Poduct', 'Product';
> ```
> ```MySQL
> RENAME TABLE Poduct to Product;
> ```

通常在 RENAME 之后按照<变更前的名称>、<变更后的名称>的顺序来指定表的名称。

各个数据库的语法都不尽相同，是因为标准 SQL 并没有 RENAME，于是各个数据库便使用了各自惯用的语法。如上所述，在创建了错误的表名，或者想要保存表的备份时，使用这些语句非常方便。但美中不足的是，由于各个数据库的语法不同，很难一下子想出恰当的指令。这时大家就可以来参考本专栏。

## 练习题

1.1 编写一条 CREATE TABLE 语句，用来创建一个包含表 1-A 中所列各项的表 Addressbook（地址簿），并为 regist_no（注册编号）列设置主键约束。

表 1-A 表 Addressbook（地址簿）中的列

| 列的含义 | 列的名称          | 数据类型              | 约束          |
| ---- | ------------- | ----------------- | ----------- |
| 注册编号 | regist_no     | 整数型               | 不能为 NULL、主键 |
| 姓名   | name          | 可变长字符串类型（长度为 128） | 不能为 NULL    |
| 住址   | address       | 可变长字符串类型（长度为 256） | 不能为 NULL    |
| 电话号码 | tel\_no       | 定长字符串类型 （长度为 10）  |             |
| 邮箱地址 | mail\_address | 定长字符串类型 （长度为 20）  |             |

1.2 假设在创建练习 1.1 中的 Addressbook 表时忘记添加如下一列 postal_code（邮政编码）了，请把此列添加到 Addressbook 表中。

列名 : postal_code
数据类型：定长字符串类型（长度为 8）
约束 : 不能为 NULL

1.3 编写 SQL 语句来删除 Addressbook 表。

1.4 编写 SQL 语句来恢复删除掉的 Addressbook 表。

